<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>é¢„è®¢å•é¡µé¢ç¤ºä¾‹</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      margin: 0;
      padding: 16px;
      background: #f5f5f5;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    h1, h2 {
      margin-top: 0;
    }
    .section {
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid #eee;
    }
    .section:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
    }
    input[type="date"],
    input[type="text"],
    input[type="tel"],
    textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      font-size: 14px;
    }
    textarea {
      resize: vertical;
      min-height: 60px;
    }
    .menu-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      grid-gap: 12px;
    }
    .menu-item {
      border: 1px solid #eee;
      border-radius: 10px;
      padding: 10px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .menu-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
    }
    .menu-name {
      font-weight: 600;
    }
    .menu-price {
      color: #e67e22;
      font-weight: 600;
    }
    .menu-code {
      font-size: 12px;
      color: #999;
      margin-bottom: 4px;
    }
    .menu-img {
      width: 100%;
      height: 120px;
      background: #ddd;
      border-radius: 8px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: #666;
    }
    .qty-row {
      display: flex;
      align-items: center;
      margin-top: 4px;
    }
    .qty-row input[type="number"] {
      width: 70px;
      padding: 4px 6px;
      margin-left: 8px;
    }
    .btn {
      display: inline-block;
      padding: 10px 18px;
      border: none;
      border-radius: 999px;
      font-size: 15px;
      cursor: pointer;
      background: #ff6b35;
      color: #fff;
      font-weight: 600;
      text-align: center;
    }
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .result-box {
      background: #f9fafb;
      border-radius: 10px;
      padding: 14px;
      border: 1px solid #e5e7eb;
      margin-top: 10px;
    }
    .result-row {
      margin-bottom: 6px;
    }
    .highlight {
      font-weight: 700;
      color: #111827;
    }
    .small {
      font-size: 13px;
      color: #6b7280;
    }
    .items-summary {
      font-size: 14px;
      margin-top: 8px;
    }
    .items-summary ul {
      margin: 4px 0 0;
      padding-left: 20px;
    }
    .error {
      color: #b91c1c;
      font-size: 13px;
      margin-top: 6px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>çº¿ä¸Šé¢„è®¢å•ï¼ˆç¤ºä¾‹ï¼‰</h1>

    <!-- é€‰æ‹©æ—¥æœŸ + åŸºæœ¬ä¿¡æ¯ -->
    <div class="section">
      <h2>1. é€‰æ‹©å–é¤æ—¥æœŸ & è”ç³»æ–¹å¼</h2>
      <div style="margin-bottom: 12px;">
        <label for="orderDate">å–é¤æ—¥æœŸï¼ˆå¿…å¡«ï¼‰</label>
        <input type="date" id="orderDate">
      </div>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
        <div>
          <label for="customerName">å§“åï¼ˆå¯é€‰ï¼‰</label>
          <input type="text" id="customerName" placeholder="ä¾‹å¦‚ï¼šå¼ ä¸‰">
        </div>
        <div>
          <label for="customerPhone">è”ç³»ç”µè¯ï¼ˆå¯é€‰ï¼‰</label>
          <input type="tel" id="customerPhone" placeholder="ä¾‹å¦‚ï¼š647-000-0000">
        </div>
      </div>
    </div>

    <!-- èœå•é€‰æ‹© -->
    <div class="section">
      <h2>2. é€‰æ‹©ç›–é¥­æ•°é‡</h2>
      <div class="menu-list" id="menuList"></div>
    </div>

    <!-- å¤‡æ³¨ -->
    <div class="section">
      <h2>3. å¤‡æ³¨ç‰¹æ®Šè¦æ±‚</h2>
      <label for="remark">å¤‡æ³¨</label>
      <textarea id="remark" placeholder="ä¾‹å¦‚ï¼šå°‘è¾£/ä¸è¦é¦™èœ/é¥­å¤šä¸€ç‚¹ç­‰"></textarea>
    </div>

    <!-- æäº¤æŒ‰é’® -->
    <div class="section">
      <button class="btn" id="submitBtn">æäº¤è®¢å•</button>
      <div class="error" id="errorMsg" style="display:none;"></div>

      <!-- ç»“æœå±•ç¤º -->
      <div id="result" style="display:none;" class="result-box">
        <div class="result-row">
          âœ… è®¢å•æäº¤æˆåŠŸï¼
        </div>
        <div class="result-row">
          è®¢å•å·ï¼š<span class="highlight" id="orderNo"></span>
        </div>
        <div class="result-row">
          æ€»é‡‘é¢ï¼š<span class="highlight" id="totalAmount"></span>
        </div>
        <div class="result-row">
          è¯· EMT è‡³ï¼š<span class="highlight" id="emtEmail">your-emt-email@example.com</span>
        </div>
        <div class="result-row small">
          ğŸ‘‰ è¯·åœ¨ EMT å¤‡æ³¨ä¸­å¡«å†™è®¢å•å·ï¼š<span class="highlight" id="orderNoForEmt"></span>
        </div>
        <div class="items-summary">
          <div>æœ¬å•èœå“ï¼š</div>
          <ul id="itemsSummary"></ul>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ------------------------
    // 1. èœå•æ•°æ®ï¼ˆä½ å¯ä»¥åœ¨è¿™é‡Œæ”¹åå­—å’Œä»·æ ¼ï¼‰
    // ------------------------
    const menuItems = [
      { id: 1, code: 'A', name: 'éº»è¾£é¸¡è…¿ç›–é¥­', price: 12.99 },
      { id: 2, code: 'B', name: 'å›é”…è‚‰ç›–é¥­',   price: 13.99 },
      { id: 3, code: 'C', name: 'é±¼é¦™è‚‰ä¸ç›–é¥­', price: 12.49 },
      { id: 4, code: 'D', name: 'å®«ä¿é¸¡ä¸ç›–é¥­', price: 13.49 },
      { id: 5, code: 'E', name: 'éº»å©†è±†è…ç›–é¥­', price: 11.99 }
    ];

    const menuListEl = document.getElementById('menuList');

    // æ¸²æŸ“èœå•
    function renderMenu() {
      menuListEl.innerHTML = '';
      menuItems.forEach(item => {
        const div = document.createElement('div');
        div.className = 'menu-item';
        div.innerHTML = `
          <div>
            <div class="menu-code">ç¼–å·ï¼š${item.code}</div>
            <div class="menu-img">å›¾ç‰‡å ä½ï¼ˆå¯æ¢æˆçœŸå®å›¾ç‰‡ï¼‰</div>
            <div class="menu-header">
              <div class="menu-name">${item.name}</div>
              <div class="menu-price">$${item.price.toFixed(2)}</div>
            </div>
          </div>
          <div class="qty-row">
            <span>æ•°é‡ï¼š</span>
            <input type="number" min="0" value="0" data-id="${item.id}">
          </div>
        `;
        menuListEl.appendChild(div);
      });
    }

    renderMenu();

    // é»˜è®¤æ—¥æœŸè®¾ä¸ºæ˜å¤©ï¼ˆå¯æ”¹ä¸ºä»Šå¤©ï¼‰
    (function setDefaultDate() {
      const dateInput = document.getElementById('orderDate');
      const d = new Date();
      // æ˜å¤©
      d.setDate(d.getDate() + 1);
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth() + 1).padStart(2, '0');
      const dd = String(d.getDate()).padStart(2, '0');
      dateInput.value = `${yyyy}-${mm}-${dd}`;
    })();

    // ------------------------
    // 2. è®¢å•æäº¤é€»è¾‘
    // ------------------------
    const submitBtn = document.getElementById('submitBtn');
    const errorMsg = document.getElementById('errorMsg');
    const resultBox = document.getElementById('result');
    const orderNoEl = document.getElementById('orderNo');
    const orderNoForEmtEl = document.getElementById('orderNoForEmt');
    const totalAmountEl = document.getElementById('totalAmount');
    const itemsSummaryEl = document.getElementById('itemsSummary');

    submitBtn.addEventListener('click', function () {
      errorMsg.style.display = 'none';
      resultBox.style.display = 'none';

      const orderDate = document.getElementById('orderDate').value;
      if (!orderDate) {
        showError('è¯·é€‰æ‹©å–é¤æ—¥æœŸ');
        return;
      }

      // è¯»å–æ•°é‡
      const qtyInputs = menuListEl.querySelectorAll('input[type="number"]');
      let hasItem = false;
      let total = 0;
      const orderedItems = [];

      qtyInputs.forEach(input => {
        const qty = parseInt(input.value || '0', 10);
        if (qty > 0) {
          const id = parseInt(input.getAttribute('data-id'), 10);
          const item = menuItems.find(m => m.id === id);
          if (item) {
            hasItem = true;
            const itemTotal = item.price * qty;
            total += itemTotal;
            orderedItems.push({
              ...item,
              quantity: qty,
              itemTotal
            });
          }
        }
      });

      if (!hasItem) {
        showError('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªèœå“çš„æ•°é‡');
        return;
      }

      // ç”Ÿæˆè®¢å•å·ï¼ˆæœ¬åœ°ç‰ˆï¼Œç”¨ localStorage æ¨¡æ‹Ÿï¼‰
      const dateStr = orderDate.replace(/-/g, ''); // 2025-11-15 -> 20251115
      const key = 'orderCount_' + dateStr;
      const prevCount = parseInt(localStorage.getItem(key) || '0', 10);
      const seq = prevCount + 1;
      localStorage.setItem(key, seq.toString());
      const seqStr = String(seq).padStart(2, '0');
      const orderNo = `${dateStr}-${seqStr}`;

      // æ˜¾ç¤ºç»“æœ
      orderNoEl.textContent = orderNo;
      orderNoForEmtEl.textContent = orderNo;
      totalAmountEl.textContent = '$' + total.toFixed(2);

      // èœå“æ‘˜è¦
      itemsSummaryEl.innerHTML = '';
      orderedItems.forEach(item => {
        const li = document.createElement('li');
        li.textContent = `${item.code} - ${item.name} x ${item.quantity} = $${item.itemTotal.toFixed(2)}`;
        itemsSummaryEl.appendChild(li);
      });

      resultBox.style.display = 'block';
    });

    function showError(msg) {
      errorMsg.textContent = msg;
      errorMsg.style.display = 'block';
    }
  </script>
</body>
</html>
