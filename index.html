<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>é¾™é—¨é˜µ MSL é¢„è®¢å•</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --primary: #f97316;
      --primary-dark: #ea580c;
      --accent-red: #ef4444;
      --bg: #0f172a;
      --card-bg: #020617;
      --text-main: #f9fafb;
      --text-sub: #9ca3af;
      --border-sub: #1f2937;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      margin: 0;
      padding: 16px;
      background: radial-gradient(circle at top, #1f2933 0, #020617 60%);
      color: var(--text-main);
    }

    .page-wrap {
      max-width: 980px;
      margin: 0 auto;
    }

    .container {
      background: linear-gradient(135deg, rgba(15,23,42,0.96), rgba(15,23,42,0.98));
      border-radius: 24px;
      padding: 18px 18px 26px;
      box-shadow: 0 25px 60px rgba(0,0,0,0.55);
      border: 1px solid rgba(148,163,184,0.2);
    }

    .header {
      display: flex;
      gap: 14px;
      margin-bottom: 18px;
      align-items: center;
    }

    .logo-wrap {
      width: 64px;
      height: 64px;
      border-radius: 20px;
      overflow: hidden;
      flex-shrink: 0;
      box-shadow: 0 10px 30px rgba(248,113,113,0.5);
    }

    .logo-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    h1 {
      margin: 0 0 4px;
      font-size: 24px;
      letter-spacing: 0.03em;
    }

    .sub-title {
      font-size: 13px;
      color: var(--text-sub);
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }

    .chip {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      color: #e5e7eb;
      background: rgba(15,23,42,0.8);
    }

    h2 {
      font-size: 17px;
      margin: 0 0 8px;
    }

    .section {
      margin-bottom: 22px;
      padding-bottom: 18px;
      border-bottom: 1px dashed rgba(55,65,81,0.7);
    }

    .section:last-child {
      border-bottom: none;
      padding-bottom: 0;
      margin-bottom: 0;
    }

    .step-tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: var(--text-sub);
      margin-bottom: 3px;
    }

    .step-circle {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      background: rgba(248,113,113,0.18);
      border: 1px solid rgba(248,113,113,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: #fecaca;
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      font-size: 13px;
    }

    input[type="date"],
    input[type="text"],
    input[type="tel"],
    textarea,
    select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid rgba(75,85,99,0.9);
      box-sizing: border-box;
      font-size: 14px;
      background: rgba(15,23,42,0.9);
      color: var(--text-main);
    }

    input::placeholder,
    textarea::placeholder {
      color: rgba(148,163,184,0.8);
    }

    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 1px rgba(249,115,22,0.4);
    }

    textarea {
      resize: vertical;
      min-height: 60px;
    }

    .two-col {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
    }

    .hint {
      font-size: 12px;
      color: var(--text-sub);
      margin-top: 4px;
    }

    .menu-group-title {
      font-size: 13px;
      font-weight: 600;
      margin: 10px 0 6px;
      color: #e5e7eb;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .menu-group-tag {
      font-size: 10px;
      padding: 1px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      color: #f97316;
    }

    .menu-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      grid-gap: 12px;
    }

    .menu-item {
      border-radius: 16px;
      padding: 8px 8px 10px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background: radial-gradient(circle at top left, rgba(248,250,252,0.02), rgba(15,23,42,0.96));
      border: 1px solid rgba(55,65,81,0.8);
      box-shadow: 0 6px 15px rgba(0,0,0,0.45);
    }

    .menu-img {
      width: 100%;
      aspect-ratio: 1 / 1;
      border-radius: 14px;
      overflow: hidden;
      margin-bottom: 8px;
      background: linear-gradient(135deg, rgba(15,23,42,0.1), rgba(15,23,42,0.7));
      position: relative;
    }

    .menu-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .menu-img-placeholder {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: rgba(255,255,255,0.8);
      background: linear-gradient(135deg, rgba(15,23,42,0.1), rgba(15,23,42,0.7));
      backdrop-filter: blur(2px);
    }

    .menu-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 4px;
      gap: 8px;
    }

    .menu-name {
      font-weight: 600;
      font-size: 14px;
      line-height: 1.3;
    }

    .menu-price {
      color: #fecaca;
      font-weight: 700;
      font-size: 14px;
      white-space: nowrap;
    }

    .menu-tags {
      font-size: 11px;
      color: var(--text-sub);
      margin-bottom: 4px;
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .tag-spicy {
      color: #f97316;
    }

    .menu-desc {
      font-size: 11px;
      color: var(--text-sub);
      margin-bottom: 6px;
    }

    .menu-footer {
      display: flex;
      justify-content: flex-end;
      margin-top: 4px;
    }

    .btn,
    .btn-secondary,
    .btn-primary,
    .btn-add,
    .cart-remove {
      font-family: inherit;
    }

    .btn {
      display: inline-block;
      padding: 12px 22px;
      border: none;
      border-radius: 999px;
      font-size: 15px;
      cursor: pointer;
      background: linear-gradient(135deg, var(--primary), var(--accent-red));
      color: #fff;
      font-weight: 600;
      text-align: center;
      box-shadow: 0 10px 24px rgba(248,113,113,0.6);
      letter-spacing: 0.03em;
    }

    .btn:active {
      transform: translateY(1px);
      box-shadow: 0 6px 16px rgba(248,113,113,0.55);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: none;
    }

    .btn-add {
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid rgba(248,113,113,0.7);
      background: rgba(248,113,113,0.1);
      color: #fecaca;
      font-size: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .btn-add:hover {
      background: rgba(248,113,113,0.25);
    }

    .error {
      color: #fecaca;
      font-size: 13px;
      margin-top: 8px;
    }

    .result-box {
      background: radial-gradient(circle at top left, rgba(34,197,94,0.2), rgba(15,23,42,0.98));
      border-radius: 16px;
      padding: 14px 14px 10px;
      border: 1px solid rgba(34,197,94,0.5);
      margin-top: 14px;
      font-size: 14px;
    }

    .result-row {
      margin-bottom: 6px;
    }

    .highlight {
      font-weight: 700;
      color: #fef9c3;
    }

    .small {
      font-size: 13px;
      color: #e5e7eb;
    }

    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: rgba(250,204,21,0.1);
      color: #facc15;
      border: 1px solid rgba(250,204,21,0.6);
      margin-left: 6px;
    }

    .items-summary {
      font-size: 14px;
      margin-top: 8px;
    }

    .items-summary ul {
      margin: 4px 0 0;
      padding-left: 20px;
    }

    .cart-empty {
      font-size: 13px;
      color: var(--text-sub);
      padding: 4px 0;
    }

    .cart-items {
      margin-top: 6px;
      border-radius: 14px;
      border: 1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.9);
      padding: 8px 10px;
      max-height: 260px;
      overflow-y: auto;
    }

    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 0;
      border-bottom: 1px dashed rgba(55,65,81,0.8);
      gap: 10px;
    }

    .cart-item:last-child {
      border-bottom: none;
    }

    .cart-item-name {
      font-size: 13px;
      font-weight: 600;
    }

    .cart-item-meta {
      font-size: 12px;
      color: var(--text-sub);
    }

    .cart-remove {
      border-radius: 999px;
      border: 1px solid rgba(239,68,68,0.7);
      background: rgba(127,29,29,0.6);
      color: #fee2e2;
      font-size: 11px;
      padding: 3px 8px;
      cursor: pointer;
      white-space: nowrap;
    }

    .cart-remove:hover {
      background: rgba(127,29,29,0.9);
    }

    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.75);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 40;
    }

    .modal {
      width: 100%;
      max-width: 340px;
      background: #020617;
      border-radius: 18px;
      padding: 14px 16px 12px;
      border: 1px solid rgba(148,163,184,0.7);
      box-shadow: 0 20px 50px rgba(0,0,0,0.6);
    }

    .modal-title {
      font-size: 16px;
      margin-bottom: 8px;
    }

    .modal-row {
      font-size: 13px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .modal-row input[type="number"],
    .modal-row select {
      max-width: 160px;
      padding: 5px 8px;
      border-radius: 8px;
      border: 1px solid rgba(75,85,99,0.9);
      background: rgba(15,23,42,0.9);
      color: var(--text-main);
      font-size: 13px;
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 6px;
    }

    .btn-secondary {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      background: rgba(15,23,42,0.9);
      color: #e5e7eb;
      padding: 6px 14px;
      font-size: 13px;
      cursor: pointer;
    }

    .btn-primary {
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, var(--primary), var(--accent-red));
      color: #fff;
      padding: 6px 16px;
      font-size: 13px;
      cursor: pointer;
    }

    @media (max-width: 640px) {
      .container {
        padding: 16px 12px 22px;
      }
      h1 {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
<div class="page-wrap">
  <div class="container">
    <div class="header">
      <div class="logo-wrap">
        <img src="./images/logo.png" alt="MSL Logo" class="logo-img">
      </div>
      <div>
        <h1>MSLé¾™é—¨é˜µ é¢„è®¢å•</h1>
        <div class="sub-title">æå‰é¢„è®¢ Â· ç°åœºå–é¤ Â· EMT æ”¯ä»˜</div>
        <div class="chips">
          <span class="chip">ä¸‰æ ¼ä¾¿å½“ Â· é‡‘æ±¤æ±¤é”… Â· éº»è¾£é¦™é”…</span>
          <span class="chip">ç‚’é¥­å¥—é¤ Â· å°é£Ÿ / æ±¤ç±»</span>
          <span class="chip">ä»¥æ”¶åˆ° EMT + å®¢æœç¡®è®¤ä¸ºå‡†</span>
        </div>
      </div>
    </div>

    <!-- 1. å–é¤ä¿¡æ¯ -->
    <div class="section">
      <div class="step-tag">
        <div class="step-circle">1</div> å¡«å†™å–é¤ä¿¡æ¯
      </div>
      <h2>å–é¤ä¿¡æ¯</h2>
      <div class="two-col">
        <div>
          <label for="orderDate">è®¢é¤æ—¥æœŸï¼ˆå¿…å¡«ï¼‰</label>
          <input type="date" id="orderDate">
          <div class="hint">
            ç›®å‰å¼€æ”¾æ¡£æœŸï¼š<span class="highlight">2025-12-05 ~ 2026-03-15</span>ï¼Œ
            ä»…é™<span class="highlight">å‘¨å…­</span>å–é¤ï¼ˆåç»­è‹¥åŠ å‘¨æ—¥ï¼Œä¼šåœ¨ç¾¤å†…é€šçŸ¥ï¼‰ã€‚
          </div>
        </div>
        <div>
          <label for="customerName">æ˜µç§°ï¼ˆå¿…å¡«ï¼‰</label>
          <input type="text" id="customerName" placeholder="ä¾‹å¦‚ï¼šå°ç‹ / å°çº¢">
          <div class="hint">ç°åœºå–é¤æ—¶å¯æŠ¥è¿™ä¸ªæ˜µç§°ã€‚</div>
        </div>
      </div>
      <div class="two-col" style="margin-top: 12px;">
        <div>
          <label for="customerPhone">è”ç³»ç”µè¯ï¼ˆå¯é€‰ï¼‰</label>
          <input type="tel" id="customerPhone" placeholder="ä¾‹å¦‚ï¼š647-000-0000">
        </div>
        <div>
          <label for="wechatId">å¾®ä¿¡å·ï¼ˆå¿…å¡«ï¼Œæ–¹ä¾¿ä¸å®¢æœæ²Ÿé€šï¼‰</label>
          <input type="text" id="wechatId" placeholder="è¯·è¾“å…¥å¸¸ç”¨å¾®ä¿¡å·">
        </div>
      </div>
    </div>

    <!-- 2. èœå•é€‰æ‹© -->
    <div class="section">
      <div class="step-tag">
        <div class="step-circle">2</div> é€‰æ‹©èœå“ï¼ˆç‚¹å‡»ã€Œï¼‹ã€æ·»åŠ åˆ°è´­ç‰©è½¦ï¼‰
      </div>
      <h2>èœå“é€‰æ‹©</h2>
      <div class="hint">
        ä¸‰æ ¼ä¾¿å½“ / é‡‘æ±¤ç³»åˆ— / éº»è¾£é¦™é”… / ç‚’é¥­å¥—é¤ / å°é£Ÿå¯é€‰æ‹©è¾£åº¦ï¼›æ±¤ç±»é»˜è®¤æ— è¾£åº¦ã€‚
        æ¯ç‚¹å‡»ä¸€æ¬¡ã€Œï¼‹ã€å³ä¸ºä¸€ç»„é…ç½®ï¼Œå¯é‡å¤æ·»åŠ ä¸åŒè¾£åº¦ä¸é¥®æ–™ç»„åˆã€‚
      </div>

      <!-- æ´»åŠ¨ç‰¹æƒ  -->
      <div class="menu-group-title">
        ğŸ”¥ æ´»åŠ¨ç‰¹æƒ 
        <span class="menu-group-tag">Special Offer</span>
      </div>
      <div class="menu-list" id="menuListPromo"></div>

      <!-- ä¸‰æ ¼ä¾¿å½“ -->
      <div class="menu-group-title">
        ğŸ± ä¸‰æ ¼ä¾¿å½“ç±»ï¼ˆä¸»èœ + ç•ªèŒ„ç‚’è›‹ + ç±³é¥­ï¼‰
        <span class="menu-group-tag">Combination Plates</span>
      </div>
      <div class="menu-list" id="menuListBento"></div>

      <!-- é‡‘æ±¤ç³»åˆ— -->
      <div class="menu-group-title">
        ğŸ² é‡‘æ±¤ç³»åˆ—ï¼ˆæ±¤é”… + ç±³é¥­ï¼‰
        <span class="menu-group-tag">Golden Soup EntrÃ©es</span>
      </div>
      <div class="menu-list" id="menuListGolden"></div>

      <!-- éº»è¾£é¦™é”…ç³»åˆ— -->
      <div class="menu-group-title">
        ğŸ² éº»è¾£é¦™é”…ç³»åˆ—ï¼ˆéº»è¾£é¦™é”… + ç±³é¥­ï¼‰
        <span class="menu-group-tag">Mala Dry Pot + Rice</span>
      </div>
      <div class="menu-list" id="menuListMala"></div>

      <!-- ç‚’é¥­å¥—é¤ -->
      <div class="menu-group-title">
        ğŸ› ç‚’é¥­å¥—é¤ï¼ˆç‚’é¥­ + æ±¤ï¼‰
        <span class="menu-group-tag">Fried Rice Combos</span>
      </div>
      <div class="menu-list" id="menuListFried"></div>

      <!-- å°é£Ÿ / åŠ è´­ -->
      <div class="menu-group-title">
        ğŸ¥— å°é£Ÿ / åŠ è´­
        <span class="menu-group-tag">Side Dish / Add-ons</span>
      </div>
      <div class="menu-list" id="menuListSide"></div>

      <!-- æ±¤ç±» -->
      <div class="menu-group-title">
        ğŸ² æ±¤ç±»ï¼ˆå•ç‚¹ï¼‰
        <span class="menu-group-tag">Soup (A La Carte)</span>
      </div>
      <div class="menu-list" id="menuListSoup"></div>
    </div>

    <!-- 3. è´­ç‰©è½¦ -->
    <div class="section">
      <div class="step-tag">
        <div class="step-circle">3</div> æŸ¥çœ‹ / ç¼–è¾‘è´­ç‰©è½¦
      </div>
      <h2>å·²é€‰èœå“</h2>
      <div class="hint">
        å¯éšæ—¶ç§»é™¤æˆ–ä¿®æ”¹ï¼Œå¦‚éœ€ä¸åŒè¾£åº¦å’Œé¥®æ–™è¯·åˆ†å¤šæ¬¡æ·»åŠ åŒä¸€èœå“ã€‚
      </div>
      <div id="cartEmpty" class="cart-empty">
        å½“å‰è´­ç‰©è½¦ä¸ºç©ºï¼Œè¯·åœ¨ä¸Šæ–¹èœå“å¡ç‰‡ä¸­ç‚¹å‡»ã€Œï¼‹ã€æ·»åŠ ã€‚
      </div>
      <div id="cartItems" class="cart-items" style="display:none;"></div>
      <div id="cartTotal" style="margin-top:8px; font-size:14px; display:none;">
        å°è®¡ï¼š<span class="highlight" id="cartTotalAmount"></span>
      </div>
    </div>

    <!-- 4. å¤‡æ³¨ + æäº¤ -->
    <div class="section">
      <div class="step-tag">
        <div class="step-circle">4</div> å¡«å†™å¤‡æ³¨å¹¶æäº¤
      </div>
      <h2>å¤‡æ³¨ç‰¹æ®Šè¦æ±‚</h2>
      <label for="remark">å¤‡æ³¨</label>
      <textarea id="remark" placeholder="ä¾‹å¦‚ï¼šç±³é¥­å°‘ä¸€ç‚¹ / ä¸è¦èŠ±ç”Ÿ / ä¸è¦èŠ±æ¤’ / å„ä»½å†™ä¸Šæ˜µç§°ç­‰"></textarea>

      <div style="margin-top:14px;">
        <button class="btn" id="submitBtn">æäº¤è®¢å•</button>
        <div class="error" id="errorMsg" style="display:none;"></div>

        <div id="result" style="display:none;" class="result-box">
          <div class="result-row">
            âœ… å°å®¢æœå¾®ä¿¡å· hotopiasc é¢„è®¢å•å·²æäº¤ï¼<span class="badge">å½“å¤©å†…å®Œæˆ EMT</span>
          </div>

          <div class="result-row">
            å–é¤æ—¥æœŸï¼š<span class="highlight" id="orderDateShow"></span>
          </div>

          <div class="result-row">
            è®¢å•æ€»é‡‘é¢ï¼š<span class="highlight" id="totalAmount"></span>
          </div>

          <div class="result-row">
            è¯· EMT è‡³ï¼š<span class="highlight" id="emtEmail">corinna29@live.ca</span>
          </div>
          <div class="result-row small">
            âš ï¸ æœ¬é¡µé¢ä¸æ˜¾ç¤ºè®¢å•å·ï¼Œè®¢å•å·ç”±åå°ç³»ç»Ÿç»Ÿä¸€æ’å·ã€‚
          </div>
          <div class="result-row small">
            ğŸ“¸ è¯·<span class="highlight">æˆªå›¾ä¿å­˜æœ¬é¡µ</span>ä½œä¸ºä¸‹å•å‡­è¯ã€‚
          </div>
          <div class="result-row small">
            ğŸ’° å®Œæˆ EMT ä»˜æ¬¾åï¼Œè¯·æ·»åŠ å°å®¢æœå¾®ä¿¡ <span class="highlight">hotopiasc</span>ï¼Œ
            å‘é€ã€Œ<span class="highlight">ä»˜æ¬¾æˆªå›¾ + æœ¬é¡µæˆªå›¾</span>ã€ï¼Œå°å®¢æœä¼šå›å¤æ‚¨çš„
            <span class="highlight">å–é¤è®¢å•å·</span>ï¼Œç°åœºå–é¤æŠ¥å·å³å¯ã€‚
          </div>
          <div class="result-row small">
            ğŸ‘‰ EMT å¤‡æ³¨å»ºè®®å¡«å†™ï¼š<span class="highlight">å¾®ä¿¡å· + å–é¤æ—¥æœŸ</span>
            ï¼ˆä¾‹å¦‚ï¼šå¾®ä¿¡å· 2025-12-13ï¼‰ï¼Œæ–¹ä¾¿åå°æ ¸å¯¹ã€‚
          </div>
          <div class="result-row small">
            âš ï¸ è®¢å•ä»…åœ¨æœ¬åº—æ”¶åˆ° EMT ä»˜æ¬¾å¹¶é€šè¿‡å¾®ä¿¡ / ç”µè¯ä¸æ‚¨ç¡®è®¤åæ‰è§†ä¸ºæœ‰æ•ˆã€‚
            å½“å¤©å†…æœªä»˜æ¬¾ï¼Œé¢„è®¢å•å°†è‡ªåŠ¨ä½œåºŸã€‚
          </div>

          <div class="items-summary">
            <div>æœ¬å•èœå“ï¼š</div>
            <ul id="itemsSummary"></ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- åŠ èœå¼¹çª—ï¼ˆè¾£åº¦ + é¥®æ–™ + æ•°é‡ï¼‰ -->
<div id="modalOverlay" class="modal-overlay">
  <div class="modal">
    <div class="modal-title" id="modalDishName">æ·»åŠ èœå“</div>
    <div class="modal-row" id="modalSpicyRow">
      <span>è¾£åº¦ï¼š</span>
      <select id="modalSpicySelect">
        <option value="ä¸è¾£">ä¸è¾£</option>
        <option value="æ­£å¸¸è¾£" selected>æ­£å¸¸è¾£</option>
        <option value="åŠ è¾£">åŠ è¾£</option>
      </select>
    </div>
    <div class="modal-row" id="modalDrinkRow" style="display:none;">
      <span>é¥®æ–™ï¼š</span>
      <select id="modalDrinkSelect"></select>
    </div>
    <div class="modal-row">
      <span>æ•°é‡ï¼š</span>
      <input type="number" id="modalQty" min="1" value="1">
    </div>
    <div class="modal-actions">
      <button id="modalCancel" class="btn-secondary">å–æ¶ˆ</button>
      <button id="modalConfirm" class="btn-primary">åŠ å…¥è´­ç‰©è½¦</button>
    </div>
  </div>
</div>

<script>
  // =======================
  // è®¢é¤æ—¥æœŸä¸æ—¶é—´é…ç½®
  // =======================

  // å…è®¸è®¢é¤çš„æ—¥æœŸåŒºé—´ï¼ˆå«é¦–å°¾ï¼‰
  const ORDER_START_DATE = '2025-12-05';
  const ORDER_END_DATE   = '2026-03-15';

  // å…è®¸çš„å–é¤æ˜ŸæœŸå‡ ï¼š0=å‘¨æ—¥,1=å‘¨ä¸€,...,6=å‘¨å…­
  // ç›®å‰ä»…å¼€æ”¾å‘¨å…­ï¼Œå°†æ¥è¦åŠ å‘¨æ—¥ï¼Œæ”¹æˆ [6, 0] å³å¯
  const ALLOWED_WEEKDAYS = [6,0];
  
  // ç»™åç«¯ç”¨çš„ pickupTime å­—æ®µï¼ˆå‰ç«¯ä¸å±•ç¤ºï¼‰
  // ä»¥åä½ æƒ³å›ºå®šæŸä¸ªæ—¶é—´å¯ä»¥ç›´æ¥æ”¹è¿™é‡Œï¼Œæ¯”å¦‚ '18:00'
  const PICKUP_TIME_DEFAULT = '';

  // é¥®æ–™é€‰é¡¹
  const DRINK_OPTIONS = ['Coke', 'Coke Zero', 'Canada Dry', 'Sprite', 'Fuze', 'Diet Coke'];

  // =========================
  // èœå•æ•°æ®
  // =========================
  const menuItems = [
    // ğŸ”¥ æ´»åŠ¨ç‰¹æƒ 
    {
      id: 18,
      category: 'promo',
      name: 'ç½‘ä¸Šä¸‹å•å…è´¹èµ é¥®æ–™ï¼ˆæ¯å•é™è´­1ï¼‰',
      price: 0.0,
      spicy: false,
      kcal: 0,
      desc: 'Online Order Only Â· Free Soft Drink Â· é™æ¯å• 1 æ¯ï¼Œéœ€æ­é…å…¶ä»–æ­£ä»·èœå“ã€‚',
      imageUrl: './images/POP.png',
      requiresDrink: true
    },

    // ğŸ± ä¸‰æ ¼ä¾¿å½“ç±»
    {
      id: 1,
      category: 'bento',
      name: 'å†œå®¶å°ç‚’è‚‰ + è¥¿çº¢æŸ¿é¸¡è›‹',
      price: 16.99,
      spicy: true,
      kcal: 833,
      desc: 'Pork, Green & Red Chili Peppers, Tomatoes & Eggs, Rice, etc.',
      imageUrl: './images/å†œå®¶å°ç‚’è‚‰.png'
    },
    {
      id: 2,
      category: 'bento',
      name: 'å®«ä¿é¸¡ä¸ (å«èŠ±ç”Ÿï¼‰ + è¥¿çº¢æŸ¿é¸¡è›‹',
      price: 16.99,
      spicy: true,
      kcal: 815,
      desc: 'Chicken, Peanuts, Red Chili Peppers, Tomatoes & Eggs, Rice, etc.',
      imageUrl: './images/å®«ä¿é¸¡ä¸.png'
    },
    {
      id: 3,
      category: 'bento',
      name: 'é±¼é¦™èŒ„å­ + è¥¿çº¢æŸ¿é¸¡è›‹',
      price: 15.99,
      spicy: true,
      kcal: 720,
      desc: 'Eggplant, Wood Ear Mushroom, Red Chili Peppers, Tomatoes & Eggs, Rice, etc.',
      imageUrl: './images/é±¼é¦™èŒ„å­.png'
    },
    {
      id: 4,
      category: 'bento',
      name: 'å·æ¤’é¸¡ç¿… + è¥¿çº¢æŸ¿é¸¡è›‹',
      price: 18.99,
      spicy: true,
      kcal: 850,
      desc: 'Chicken Wings, Green & Red Chili Peppers, Tomatoes & Eggs, Rice, etc.',
      imageUrl: './images/å·æ¤’é¸¡ç¿….png'
    },
    {
      id: 5,
      category: 'bento',
      name: 'å°–æ¤’è‚¥è‚  + è¥¿çº¢æŸ¿é¸¡è›‹',
      price: 16.99,
      spicy: true,
      kcal: 820,
      desc: 'Pork Intestine, Green & Red Chili Peppers, Tomatoes & Eggs, Rice, etc.',
      imageUrl: './images/å°–æ¤’è‚¥è‚ .png'
    },
    {
      id: 6,
      category: 'bento',
      name: 'é…¸è±†è§’ç‚’è‚‰æ²« + è¥¿çº¢æŸ¿é¸¡è›‹',
      price: 17.99,
      spicy: true,
      kcal: 738,
      desc: 'Minced Pork, Pickled Green Beans, Tomatoes & Eggs, Rice, etc.',
      imageUrl: './images/é…¸è±†è§’è‚‰æ²«.png'
    },
    {
      id: 7,
      category: 'bento',
      name: 'ç…§çƒ§è‚¥ç‰› + è¥¿çº¢æŸ¿é¸¡è›‹',
      price: 17.99,
      spicy: false,
      kcal: 845,
      desc: 'Teriyaki Beef, Tomatoes & Eggs, Rice, etc.',
      imageUrl: './images/ç…§çƒ§ç‰›è‚‰.png'
    },
    {
      id: 10,
      category: 'bento',
      name: 'ç³–é†‹é±¼æŸ³ + è¥¿çº¢æŸ¿é¸¡è›‹',
      price: 16.99,
      spicy: false,
      kcal: 750,
      desc: 'Fried Fish Fillet, Sweet & Sour Sauce, Tomatoes & Eggs, Rice, etc.',
      imageUrl: './images/ç³–é†‹é±¼æŸ³.png'
    },
    {
      id: 11,
      category: 'bento',
      name: 'éº»å©†è±†è… + è¥¿çº¢æŸ¿é¸¡è›‹',
      price: 15.99,
      spicy: true,
      kcal: 719,
      desc: 'Minced Pork, Tofu, Chili Peppers, Tomatoes & Eggs, Rice, etc.',
      imageUrl: './images/éº»å©†è±†è….png'
    },

    // ğŸ² é‡‘æ±¤ç³»åˆ—
    {
      id: 12,
      category: 'golden',
      name: 'é‡‘æ±¤é…¸èœé±¼ + ç±³é¥­',
      price: 18.49,
      spicy: true,
      kcal: 860,
      desc: 'Fish Fillet, Enoki Mushroom, Glass Noodles, Golden Pickled Cabbage Soup, Rice, etc.',
      imageUrl: './images/é‡‘æ±¤é…¸èœé±¼.png'
    },
    {
      id: 13,
      category: 'golden',
      name: 'é‡‘æ±¤é…¸èœè‚¥ç‰› + ç±³é¥­',
      price: 18.49,
      spicy: true,
      kcal: 870,
      desc: 'Beef Slices, Enoki Mushroom, Glass Noodles, Golden Pickled Cabbage Soup, Rice, etc.',
      imageUrl: './images/é‡‘æ±¤é…¸èœè‚¥ç‰›.png'
    },

    // ğŸ² éº»è¾£é¦™é”…ç³»åˆ—
    {
      id: 8,
      category: 'mala',
      name: 'è‚‰é£Ÿä¸»ä¹‰ + ç±³é¥­',
      price: 18.99,
      spicy: true,
      kcal: 910,
      desc: 'Meat Balls, Pork Intestine, Spam, Beef Tripe, Rice, etc.',
      imageUrl: './images/è‚‰é£Ÿä¸»ä¹‰.png'
    },
    {
      id: 9,
      category: 'mala',
      name: 'é¦™è¾£å››å–œ + ç±³é¥­',
      price: 18.99,
      spicy: true,
      kcal: 810,
      desc: 'Shrimp, Pork Rib, Beef Sirloin, Lamb Cube, Rice, etc.',
      imageUrl: './images/é¦™è¾£å››å–œ.png'
    },

    // ğŸ› ç‚’é¥­å¥—é¤
    {
      id: 14,
      category: 'fried',
      name: 'å’–å–±ç‰›è‚‰ç‚’é¥­ + å†¬ç“œè™¾ä»æ±¤',
      price: 16.0,
      spicy: false,
      kcal: 854,
      desc: 'Curry Beef Fried Rice + Winter Melon Shrimp Soup',
      imageUrl: './images/å’–å–±ç‰›è‚‰.png'
    },
    {
      id: 15,
      category: 'fried',
      name: 'é‚£ä¸€å¹´è›‹ç‚’é¥­ + å†¬ç“œè™¾ä»æ±¤',
      price: 16.0,
      spicy: false,
      kcal: 754,
      desc: 'Classic Fried Rice + Winter Melon Shrimp Soup',
      imageUrl: './images/é‚£ä¸€å¹´è›‹ç‚’é¥­.png'
    },

    // ğŸ¥— å°é£Ÿ / åŠ è´­
    {
      id: 16,
      category: 'side',
      name: 'å‡‰æ‹ŒåœŸè±†ä¸ + POP',
      price: 3.0,
      spicy: true,
      kcal: 430,
      desc: 'Shredded Potatoes, Chili Peppers, Green Onions, etc. Â· è‡ªé€‰æ±½æ°´ä¸€æ¯ã€‚',
      imageUrl: './images/å¥—é¤.png',
      requiresDrink: true
    },

    // ğŸ² æ±¤ç±»
    {
      id: 17,
      category: 'soup',
      name: 'å†¬ç“œè™¾ä»æ±¤ï¼ˆ12ozï¼‰',
      price: 3.99,
      spicy: false,
      kcal: 94,
      desc: 'Winter Melon & Shrimp Soup',
      imageUrl: './images/å†¬ç“œè™¾ä»æ±¤.png'
    }
  ];

  // Apps Script Web App URL
  const SHEET_API_URL =
    "https://script.google.com/macros/s/AKfycbz6W6bAbJL6bDBFzYBi3gswJUQ6qon29bZo4bUnOeKZ0xw9aoCZARz4gxlRJBDzVspW/exec";

  // ä½ è‡ªå·±çš„ EMT é‚®ç®±
  const EMT_EMAIL = "corinna29@live.ca";

  let hasSubmitted = false;
  let cart = [];

  const menuListPromoEl  = document.getElementById('menuListPromo');
  const menuListBentoEl  = document.getElementById('menuListBento');
  const menuListGoldenEl = document.getElementById('menuListGolden');
  const menuListMalaEl   = document.getElementById('menuListMala');
  const menuListFriedEl  = document.getElementById('menuListFried');
  const menuListSideEl   = document.getElementById('menuListSide');
  const menuListSoupEl   = document.getElementById('menuListSoup');

  const cartEmptyEl = document.getElementById('cartEmpty');
  const cartItemsEl = document.getElementById('cartItems');
  const cartTotalBox = document.getElementById('cartTotal');
  const cartTotalAmountEl = document.getElementById('cartTotalAmount');

  const submitBtn = document.getElementById('submitBtn');
  const errorMsg = document.getElementById('errorMsg');
  const resultBox = document.getElementById('result');
  const totalAmountEl = document.getElementById('totalAmount');
  const itemsSummaryEl = document.getElementById('itemsSummary');
  const orderDateShowEl = document.getElementById('orderDateShow');
  const emtEmailEl = document.getElementById('emtEmail');

  emtEmailEl.textContent = EMT_EMAIL;

  // å¼¹çª—å…ƒç´ 
  const modalOverlay = document.getElementById('modalOverlay');
  const modalDishNameEl = document.getElementById('modalDishName');
  const modalSpicyRow = document.getElementById('modalSpicyRow');
  const modalSpicySelect = document.getElementById('modalSpicySelect');
  const modalDrinkRow = document.getElementById('modalDrinkRow');
  const modalDrinkSelect = document.getElementById('modalDrinkSelect');
  const modalQtyInput = document.getElementById('modalQty');
  const modalCancelBtn = document.getElementById('modalCancel');
  const modalConfirmBtn = document.getElementById('modalConfirm');

  let currentDishId = null;

  // =========================
  // æ—¥æœŸå·¥å…·å‡½æ•°
  // =========================
  function createDateFromStr(str) {
    const [y, m, d] = str.split('-').map(n => parseInt(n, 10));
    return new Date(y, m - 1, d);
  }

  // é»˜è®¤æ—¥æœŸè®¾ä¸ºã€Œä»ä»Šå¤©å¼€å§‹ï¼Œå¾€åæ‰¾ç¬¬ä¸€ä¸ªå…è®¸çš„å‘¨å‡ ã€
  (function setDefaultDate() {
    const dateInput = document.getElementById('orderDate');
    const start = createDateFromStr(ORDER_START_DATE);
    const end = createDateFromStr(ORDER_END_DATE);
    const now = new Date();

    let d = now < start ? new Date(start.getTime()) : new Date(now.getFullYear(), now.getMonth(), now.getDate());

    while (d <= end) {
      const weekday = d.getDay();
      if (ALLOWED_WEEKDAYS.includes(weekday)) {
        break;
      }
      d.setDate(d.getDate() + 1);
    }

    if (d > end) {
      d = start;
    }

    const yyyy = d.getFullYear();
    const mm = String(d.getMonth() + 1).padStart(2, '0');
    const dd = String(d.getDate()).padStart(2, '0');
    const val = `${yyyy}-${mm}-${dd}`;

    dateInput.value = val;
    dateInput.min = ORDER_START_DATE;
    dateInput.max = ORDER_END_DATE;
  })();

  // =========================
  // èœå•æ¸²æŸ“
  // =========================
  function renderMenuForCategory(category, containerEl) {
    containerEl.innerHTML = '';
    menuItems
      .filter(item => item.category === category)
      .forEach(item => {
        const div = document.createElement('div');
        div.className = 'menu-item';

        const imgHtml = `
          <div class="menu-img">
            ${item.imageUrl
              ? `<img src="${item.imageUrl}" alt="${item.name}">`
              : `<div class="menu-img-placeholder">èœå“å›¾ç‰‡å ä½</div>`
            }
          </div>
        `;

        const spicyTagText = item.spicy ? 'å¯é€‰è¾£åº¦' : 'é»˜è®¤æ— è¾£åº¦';
        const priceText = item.price > 0
          ? `CAD $${item.price.toFixed(2)}`
          : 'CAD $0.00';

        div.innerHTML = `
          ${imgHtml}
          <div>
            <div class="menu-header">
              <div class="menu-name">${item.name}</div>
              <div class="menu-price">${priceText}</div>
            </div>
            <div class="menu-tags">
              <span class="${item.spicy ? 'tag-spicy' : ''}">${spicyTagText}</span>
              <span>${item.kcal || 0} Kcal</span>
            </div>
            <div class="menu-desc">${item.desc}</div>
            <div class="menu-footer">
              <button class="btn-add" data-id="${item.id}">
                ï¼‹ åŠ å…¥
              </button>
            </div>
          </div>
        `;

        containerEl.appendChild(div);
      });
  }

  function renderAllMenus() {
    renderMenuForCategory('promo',  menuListPromoEl);
    renderMenuForCategory('bento',  menuListBentoEl);
    renderMenuForCategory('golden', menuListGoldenEl);
    renderMenuForCategory('mala',   menuListMalaEl);
    renderMenuForCategory('fried',  menuListFriedEl);
    renderMenuForCategory('side',   menuListSideEl);
    renderMenuForCategory('soup',   menuListSoupEl);
  }

  renderAllMenus();

  // =========================
  // å¼¹çª—æ§åˆ¶
  // =========================
  function openModal(dishId) {
    const dish = menuItems.find(m => m.id === dishId);
    if (!dish) return;
    currentDishId = dishId;
    modalDishNameEl.textContent = dish.name;
    modalQtyInput.value = 1;
    modalQtyInput.disabled = false;

    // è¾£åº¦è¡Œï¼ˆéƒ¨åˆ†èœå“ä¸èƒ½é€‰â€œä¸è¾£â€ï¼‰
if (dish.spicy) {
  modalSpicyRow.style.display = 'flex';

  // è¿™äº›èœåªèƒ½ æ­£å¸¸è¾£ / åŠ è¾£
  const noMildDishIds = [1, 5, 6, 11];

  // å…ˆæ¸…ç©ºåŸæ¥çš„é€‰é¡¹
  modalSpicySelect.innerHTML = '';

  // æ ¹æ®èœå“ ID å†³å®šè¾£åº¦é€‰é¡¹
  const options = noMildDishIds.includes(dish.id)
    ? ['æ­£å¸¸è¾£', 'åŠ è¾£']          // è¿™å‡ é“ä¸èƒ½é€‰â€œä¸è¾£â€
    : ['ä¸è¾£', 'æ­£å¸¸è¾£', 'åŠ è¾£'];  // å…¶ä»–èœä¿æŒåŸæ¥çš„ä¸‰æ¡£

  options.forEach(text => {
    const opt = document.createElement('option');
    opt.value = text;
    opt.textContent = text;
    if (text === 'æ­£å¸¸è¾£') {
      opt.selected = true;
    }
    modalSpicySelect.appendChild(opt);
  });

} else {
  modalSpicyRow.style.display = 'none';
  modalSpicySelect.innerHTML = '';
}

    // é¥®æ–™è¡Œ
    if (dish.requiresDrink) {
      modalDrinkRow.style.display = 'flex';
      modalDrinkSelect.innerHTML = '';
      DRINK_OPTIONS.forEach(dr => {
        const opt = document.createElement('option');
        opt.value = dr;
        opt.textContent = dr;
        modalDrinkSelect.appendChild(opt);
      });
    } else {
      modalDrinkRow.style.display = 'none';
      modalDrinkSelect.innerHTML = '';
    }

    // å…è´¹èµ é¥®ï¼šæ•°é‡é”æ­»ä¸º 1
    if (dish.category === 'promo') {
      modalQtyInput.value = 1;
      modalQtyInput.disabled = true;
    }

    modalOverlay.style.display = 'flex';
  }

  function closeModal() {
    modalOverlay.style.display = 'none';
    currentDishId = null;
  }

  modalCancelBtn.addEventListener('click', closeModal);

  modalOverlay.addEventListener('click', function (e) {
    if (e.target === modalOverlay) {
      closeModal();
    }
  });

  modalConfirmBtn.addEventListener('click', function () {
    if (currentDishId == null) return;
    const dish = menuItems.find(m => m.id === currentDishId);
    if (!dish) return;

    let qty = parseInt(modalQtyInput.value || '1', 10);
    if (isNaN(qty) || qty <= 0) {
      alert('æ•°é‡è‡³å°‘ä¸º 1');
      return;
    }

    // å…è´¹èµ é¥®å§‹ç»ˆä¸º 1
    if (dish.category === 'promo') {
      qty = 1;
    }

    let spicyLevel = '';
if (dish.spicy) {
  spicyLevel = modalSpicySelect.value;

  // å¦‚æœæ²¡é€‰è¾£åº¦ï¼Œç›´æ¥æç¤ºå¹¶æ‹¦æˆª
  if (!spicyLevel) {
    alert('è¯·å…ˆé€‰æ‹©è¾£åº¦~');
    return;
  }
}
    let drink = '';
    if (dish.requiresDrink) {
      drink = modalDrinkSelect.value || DRINK_OPTIONS[0];
    }

    // æ£€æŸ¥è´­ç‰©è½¦é‡Œæ˜¯å¦å·²ç»æœ‰å…è´¹èµ é¥®
    if (dish.category === 'promo') {
      const hasPromo = cart.some(item => item.category === 'promo');
      if (hasPromo) {
        alert('æ¯å•ä»…é™é¢†å– 1 æ¯å…è´¹èµ é¥®ã€‚');
        return;
      }
    }

    const existingIndex = cart.findIndex(
      item => item.id === dish.id &&
              item.spicyLevel === spicyLevel &&
              item.drink === drink
    );

    if (existingIndex >= 0 && dish.category !== 'promo') {
      cart[existingIndex].quantity += qty;
    } else {
      cart.push({
        id: dish.id,
        name: dish.name,
        price: dish.price,
        spicyLevel,
        quantity: qty,
        drink,
        category: dish.category
      });
    }

    renderCart();
    closeModal();
  });

  // =========================
  // è´­ç‰©è½¦æ¸²æŸ“
  // =========================
  function renderCart() {
    if (cart.length === 0) {
      cartEmptyEl.style.display = 'block';
      cartItemsEl.style.display = 'none';
      cartTotalBox.style.display = 'none';
      cartItemsEl.innerHTML = '';
      cartTotalAmountEl.textContent = '';
      return;
    }

    cartEmptyEl.style.display = 'none';
    cartItemsEl.style.display = 'block';
    cartTotalBox.style.display = 'block';

    cartItemsEl.innerHTML = '';
    let total = 0;

    cart.forEach((item, index) => {
      const lineTotal = item.price * item.quantity;
      total += lineTotal;
      const spicyText = item.spicyLevel ? `ï¼ˆ${item.spicyLevel}ï¼‰` : '';
      const drinkText = item.drink ? ` ï½œ é¥®æ–™ï¼š${item.drink}` : '';
      const div = document.createElement('div');
      div.className = 'cart-item';
      div.innerHTML = `
        <div>
          <div class="cart-item-name">${item.name}${spicyText}</div>
          <div class="cart-item-meta">æ•°é‡ï¼šx${item.quantity} ï½œ å°è®¡ï¼šCAD $${lineTotal.toFixed(2)}${drinkText}</div>
        </div>
        <button class="cart-remove" data-index="${index}">åˆ é™¤</button>
      `;
      cartItemsEl.appendChild(div);
    });

    cartTotalAmountEl.textContent = 'CAD $' + total.toFixed(2);
  }

  document.addEventListener('click', function (e) {
    const addBtn = e.target.closest('.btn-add');
    if (addBtn) {
      const id = parseInt(addBtn.getAttribute('data-id'), 10);
      openModal(id);
      return;
    }

    const removeBtn = e.target.closest('.cart-remove');
    if (removeBtn) {
      const idx = parseInt(removeBtn.getAttribute('data-index'), 10);
      if (!isNaN(idx)) {
        cart.splice(idx, 1);
        renderCart();
      }
      return;
    }
  });

  function showError(msg) {
    errorMsg.textContent = msg;
    errorMsg.style.display = 'block';
  }

  // =========================
  // æäº¤è®¢å•
  // =========================
  submitBtn.addEventListener('click', function () {
    errorMsg.style.display = 'none';
    resultBox.style.display = 'none';

    if (hasSubmitted) {
      showError('æœ¬é¡µé¢å·²æˆåŠŸæäº¤ä¸€ä»½é¢„è®¢å•ï¼Œå¦‚éœ€å†æ¬¡ä¸‹å•è¯·åˆ·æ–°é¡µé¢æˆ–é‡æ–°æ‰“å¼€é“¾æ¥ã€‚');
      return;
    }

    const orderDate = document.getElementById('orderDate').value;
    const nickName = document.getElementById('customerName').value.trim();
    const phone = document.getElementById('customerPhone').value.trim();
    const wechatId = document.getElementById('wechatId').value.trim();
    const remark = document.getElementById('remark').value.trim();

    if (!orderDate) {
      return showError('è¯·é€‰æ‹©å–é¤æ—¥æœŸ');
    }

    const todayStr = new Date().toISOString().slice(0, 10);
    if (orderDate < todayStr) {
      return showError('å–é¤æ—¥æœŸä¸èƒ½æ—©äºä»Šå¤©');
    }

    if (orderDate < ORDER_START_DATE || orderDate > ORDER_END_DATE) {
      return showError('å–é¤æ—¥æœŸè¶…å‡ºå½“å‰å¼€æ”¾æ¡£æœŸï¼Œè¯·é‡æ–°é€‰æ‹©ã€‚');
    }

    const d = createDateFromStr(orderDate);
    const weekday = d.getDay(); // 0=å‘¨æ—¥...6=å‘¨å…­
    if (!ALLOWED_WEEKDAYS.includes(weekday)) {
      return showError('ç›®å‰ä»…å¼€æ”¾å‘¨å…­å–é¤ï¼Œè¯·é€‰æ‹©å‘¨å…­æ—¥æœŸ');
    }

    if (!nickName) {
      return showError('è¯·å¡«å†™æ˜µç§°');
    }

    if (!wechatId) {
      return showError('è¯·å¡«å†™å¾®ä¿¡å·ï¼Œæ–¹ä¾¿ä¸å®¢æœæ²Ÿé€š');
    }

    if (cart.length === 0) {
      return showError('è´­ç‰©è½¦ä¸ºç©ºï¼Œè¯·å…ˆæ·»åŠ è‡³å°‘ä¸€ä»½èœå“');
    }

    // å¦‚æœæœ‰å…è´¹èµ é¥®æ–™ï¼Œå¿…é¡»æœ‰è‡³å°‘ä¸€ä»½é™¤ã€Œå‡‰æ‹ŒåœŸè±†ä¸+POPã€ä»¥å¤–çš„æ­£ä»·èœå“
    const hasPromoDrink = cart.some(item => item.category === 'promo');
    if (hasPromoDrink) {
      const hasRealFood = cart.some(
        item => item.category !== 'promo' && item.id !== 16
      );
      if (!hasRealFood) {
        return showError('é¢†å–å…è´¹èµ é¥®æ–™éœ€æ­é…è‡³å°‘ä¸€ä»½æ­£ä»·èœå“ï¼ˆä¸å«å‡‰æ‹ŒåœŸè±†ä¸+POPï¼‰ã€‚');
      }
    }

    // è®¡ç®—æ€»é‡‘é¢
    let totalAmount = 0;
    cart.forEach(item => {
      totalAmount += item.price * item.quantity;
    });

    // ç»™åç«¯çš„å–é¤æ—¶é—´ï¼ˆå‰ç«¯ä¸å±•ç¤ºï¼‰
    const pickupTime = PICKUP_TIME_DEFAULT;

    // æœ¬åœ° UI å±•ç¤ºï¼ˆä¸å±•ç¤ºè®¢å•å·ï¼‰
    totalAmountEl.textContent = 'CAD $' + totalAmount.toFixed(2);
    orderDateShowEl.textContent = orderDate;

    // èœå“åˆ—è¡¨å±•ç¤º
    itemsSummaryEl.innerHTML = '';
    const linesForBackend = [];
    cart.forEach(item => {
      const spicyText = item.spicyLevel ? `ï¼ˆ${item.spicyLevel}ï¼‰` : '';
      const drinkText = item.drink ? `ï¼ˆé¥®æ–™ï¼š${item.drink}ï¼‰` : '';
      const lineText = `${item.name}${spicyText}${drinkText} Ã— ${item.quantity} = CAD $${(item.price * item.quantity).toFixed(2)}`;

      const li = document.createElement('li');
      li.textContent = lineText;
      itemsSummaryEl.appendChild(li);

      linesForBackend.push(lineText);
    });
    if (remark) {
      const li = document.createElement('li');
      li.textContent = `å¤‡æ³¨ï¼š${remark}`;
      itemsSummaryEl.appendChild(li);
    }

    resultBox.style.display = 'block';

    // é˜²æ­¢é‡å¤æäº¤ï¼ˆå½“å‰é¡µé¢ï¼‰
    hasSubmitted = true;
    submitBtn.disabled = true;
    submitBtn.textContent = 'å·²æäº¤ï¼ˆæ­£åœ¨å‘é€åˆ°åå°ï¼‰';

    // å‘ç»™ Apps Script çš„æ•°æ®æ ¼å¼ï¼ˆä¸å†ä¼ å‰ç«¯ç”Ÿæˆçš„ orderNoï¼‰
    const payload = {
      orderDate: orderDate,
      pickupTime: pickupTime || '',
      nickName: nickName,
      wechatId: wechatId,
      phone: phone,
      totalAmount: totalAmount.toFixed(2),
      itemsDetail: linesForBackend.join('\n'),
      remark: remark || ''
    };

    // å‘é€åˆ° Google Apps Scriptï¼ˆno-corsï¼Œé¿å… CORS é—®é¢˜ï¼‰
    fetch(SHEET_API_URL, {
      method: 'POST',
      mode: 'no-cors',
      cache: 'no-cache',
      headers: {
        'Content-Type': 'text/plain;charset=utf-8'
      },
      body: JSON.stringify(payload)
    })
      .then(() => {
        console.log('Order sent to backend (no-cors).');
        // UI å·²ç»å±•ç¤ºæˆåŠŸä¿¡æ¯
      })
      .catch(err => {
        console.error('Submission Error:', err);
        showError('è®¢å•å·²åœ¨æœ¬é¡µç”Ÿæˆï¼Œä½†å‘é€åˆ°åå°æ—¶å‡ºé”™ï¼Œè¯·è”ç³»å®¢æœç¡®è®¤æ˜¯å¦æ”¶åˆ°ã€‚é”™è¯¯ï¼š' + err.message);
        submitBtn.disabled = false;
        submitBtn.textContent = 'æäº¤è®¢å•';
        hasSubmitted = false;
      });
  });
</script>
</body>
</html>






