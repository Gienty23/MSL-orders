<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>MSL é¢„è®¢å•</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      margin: 0;
      padding: 16px;
      background: #f5f5f5;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: #fff;
      border-radius: 16px;
      padding: 20px 18px 28px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.06);
    }
    h1 {
      margin: 0 0 4px;
      font-size: 24px;
    }
    .sub-title {
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 16px;
    }
    h2 {
      font-size: 18px;
      margin: 0 0 8px;
    }
    .section {
      margin-bottom: 22px;
      padding-bottom: 16px;
      border-bottom: 1px solid #eee;
    }
    .section:last-child {
      border-bottom: none;
      padding-bottom: 0;
      margin-bottom: 0;
    }
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      font-size: 14px;
    }
    input[type="date"],
    input[type="time"],
    input[type="text"],
    input[type="tel"],
    textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      box-sizing: border-box;
      font-size: 14px;
    }
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #f97316;
      box-shadow: 0 0 0 1px rgba(249,115,22,0.3);
    }
    textarea {
      resize: vertical;
      min-height: 60px;
    }
    .two-col {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
    }
    .menu-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      grid-gap: 12px;
    }
    .menu-item {
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 10px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background: #fcfcfc;
    }
    .menu-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 4px;
    }
    .menu-name {
      font-weight: 600;
      font-size: 14px;
    }
    .menu-price {
      color: #e67e22;
      font-weight: 600;
      font-size: 14px;
    }
    .menu-category {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 4px;
    }
    .qty-row {
      display: flex;
      align-items: center;
      margin-top: 6px;
      font-size: 13px;
      justify-content: space-between;
      gap: 8px;
    }
    .qty-row input[type="number"] {
      width: 80px;
      padding: 4px 6px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
    }
    .spicy-row {
      display: flex;
      align-items: center;
      margin-top: 6px;
      font-size: 13px;
      justify-content: space-between;
      gap: 8px;
    }
    .spicy-row select {
      flex: 1;
      padding: 4px 6px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-size: 13px;
    }
    .hint {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 4px;
    }
    .btn {
      display: inline-block;
      padding: 11px 20px;
      border: none;
      border-radius: 999px;
      font-size: 15px;
      cursor: pointer;
      background: linear-gradient(135deg, #fb923c, #ef4444);
      color: #fff;
      font-weight: 600;
      text-align: center;
      box-shadow: 0 8px 18px rgba(248,113,113,0.35);
    }
    .btn:active {
      transform: translateY(1px);
      box-shadow: 0 4px 10px rgba(248,113,113,0.35);
    }
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: none;
    }
    .error {
      color: #b91c1c;
      font-size: 13px;
      margin-top: 8px;
    }
    .result-box {
      background: #f9fafb;
      border-radius: 12px;
      padding: 14px 14px 10px;
      border: 1px solid #e5e7eb;
      margin-top: 14px;
      font-size: 14px;
    }
    .result-row {
      margin-bottom: 6px;
    }
    .highlight {
      font-weight: 700;
      color: #111827;
    }
    .small {
      font-size: 13px;
      color: #6b7280;
    }
    .items-summary {
      font-size: 14px;
      margin-top: 8px;
    }
    .items-summary ul {
      margin: 4px 0 0;
      padding-left: 20px;
    }
    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: #fef3c7;
      color: #92400e;
      margin-left: 6px;
    }
    .group-title {
      font-size: 13px;
      font-weight: 600;
      margin: 10px 0 4px;
      color: #4b5563;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>MSL é¢„è®¢å•</h1>
    <div class="sub-title">
      è¯·é€‰æ‹©å–é¤æ—¥æœŸä¸èœå“ï¼Œæäº¤åæ ¹æ®é¡µé¢æç¤ºå®Œæˆ EMT æ”¯ä»˜ã€‚
    </div>

    <!-- 1. å–é¤ä¿¡æ¯ -->
    <div class="section">
      <h2>1. å–é¤ä¿¡æ¯</h2>
      <div class="two-col">
        <div>
          <label for="orderDate">å–é¤æ—¥æœŸï¼ˆå¿…å¡«ï¼‰</label>
          <input type="date" id="orderDate">
          <div class="hint">è¯·é€‰æ‹©æ‚¨è®¡åˆ’å–é¤çš„æ—¥æœŸã€‚</div>
        </div>
        <div>
          <label for="pickupTime">å–é¤æ—¶é—´ï¼ˆå¯é€‰ï¼‰</label>
          <input type="time" id="pickupTime">
          <div class="hint">ä¾‹å¦‚ï¼š18:30ï¼Œå¦‚æœ‰å˜åŠ¨ä»¥å®¢æœé€šçŸ¥ä¸ºå‡†ã€‚</div>
        </div>
      </div>
      <div class="two-col" style="margin-top: 12px;">
        <div>
          <label for="customerName">æ˜µç§°ï¼ˆå¿…å¡«ï¼‰</label>
          <input type="text" id="customerName" placeholder="ä¾‹å¦‚ï¼šå°ç‹ / å°çº¢">
        </div>
        <div>
          <label for="customerPhone">è”ç³»ç”µè¯ï¼ˆå¯é€‰ï¼Œæ–¹ä¾¿ç°åœºè”ç³»ï¼‰</label>
          <input type="tel" id="customerPhone" placeholder="ä¾‹å¦‚ï¼š647-000-0000">
        </div>
      </div>
      <div style="margin-top: 12px;">
        <label for="wechatId">å¾®ä¿¡å·ï¼ˆå¿…å¡«ï¼Œæ–¹ä¾¿ä¸å®¢æœæ²Ÿé€šï¼‰</label>
        <input type="text" id="wechatId" placeholder="è¯·è¾“å…¥å¸¸ç”¨å¾®ä¿¡å·">
      </div>
    </div>

    <!-- 2. èœå•é€‰æ‹© -->
    <div class="section">
      <h2>2. é€‰æ‹©èœå“ä¸æ•°é‡</h2>
      <div class="hint">
        æ‰€æœ‰èœå“å‡å¯é€‰æ‹©è¾£åº¦ï¼ˆä¸è¾£ / æ­£å¸¸è¾£ / åŠ è¾£ï¼‰ã€‚é¥®æ–™ä»…é€‰æ‹©æ•°é‡å³å¯ã€‚
      </div>
      <div id="group-fan" class="group-title">ç›–é¥­ç±»</div>
      <div class="menu-list" id="menuListMain"></div>

      <div id="group-friedrice" class="group-title">ç‚’é¥­ç±»</div>
      <div class="menu-list" id="menuListRice"></div>

      <div id="group-snack" class="group-title">å°é£Ÿ</div>
      <div class="menu-list" id="menuListSnack"></div>

      <div id="group-drinks" class="group-title">é¥®æ–™</div>
      <div class="menu-list" id="menuListDrinks"></div>
    </div>

    <!-- 3. å¤‡æ³¨ -->
    <div class="section">
      <h2>3. å¤‡æ³¨ç‰¹æ®Šè¦æ±‚</h2>
      <label for="remark">å¤‡æ³¨</label>
      <textarea id="remark" placeholder="ä¾‹å¦‚ï¼šç±³é¥­å°‘ä¸€ç‚¹ / ä¸è¦èŠ±ç”Ÿ / å„ä»½åˆ†å¼€æ‰“åŒ…ç­‰"></textarea>
    </div>

    <!-- 4. æäº¤ & ç»“æœ -->
    <div class="section">
      <button class="btn" id="submitBtn">æäº¤è®¢å•</button>
      <div class="error" id="errorMsg" style="display:none;"></div>

      <div id="result" style="display:none;" class="result-box">
        <div class="result-row">
          âœ… è®¢å•æäº¤æˆåŠŸï¼<span class="badge">è¯·åœ¨ 30 åˆ†é’Ÿå†…å®Œæˆ EMT</span>
        </div>
        <div class="result-row">
          è®¢å•å·ï¼š<span class="highlight" id="orderNo"></span>
        </div>
        <div class="result-row">
          å–é¤æ—¥æœŸï¼š<span class="highlight" id="orderDateShow"></span>
          <span id="pickupTimeShowWrapper" style="display:none;"> ï½œ å–é¤æ—¶é—´ï¼š<span class="highlight" id="pickupTimeShow"></span></span>
        </div>
        <div class="result-row">
          è®¢å•æ€»é‡‘é¢ï¼š<span class="highlight" id="totalAmount"></span>
        </div>
        <div class="result-row">
          <!-- TODOï¼šæ”¹æˆä½ çš„ EMT é‚®ç®± -->
          è¯· EMT è‡³ï¼š<span class="highlight" id="emtEmail">your-emt-email@example.com</span>
        </div>
        <div class="result-row small">
          ğŸ‘‰ EMT å¤‡æ³¨è¯·å¡«å†™è®¢å•å·ï¼š<span class="highlight" id="orderNoForEmt"></span>
        </div>
        <div class="result-row small">
          âš ï¸ è®¢å•ä»…åœ¨æœ¬åº—æ”¶åˆ° EMT ä»˜æ¬¾å¹¶é€šè¿‡å¾®ä¿¡ / ç”µè¯ä¸æ‚¨ç¡®è®¤åæ‰è§†ä¸ºæœ‰æ•ˆã€‚å¦‚ 30 åˆ†é’Ÿå†…æœªä»˜æ¬¾ï¼Œé¢„è®¢å•å°†è‡ªåŠ¨ä½œåºŸã€‚
        </div>
        <div class="items-summary">
          <div>æœ¬å•èœå“ï¼š</div>
          <ul id="itemsSummary"></ul>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ================================
    // èœå•æ•°æ®
    // ================================
    // spicy: true è¡¨ç¤ºå¯ä»¥é€‰æ‹©è¾£åº¦ï¼›false è¡¨ç¤ºé¥®æ–™ç­‰ä¸é€‰è¾£åº¦
    const menuItems = [
      // ç›–é¥­ç±»
      { id: 1, category: 'fan', name: 'å­Ÿè·ç•ªèŒ„è›‹ç›–é¥­', price: 14.99, spicy: true },
      { id: 2, category: 'fan', name: 'å®«ä¿é¸¡ä¸ç›–é¥­', price: 15.99, spicy: true },
      { id: 3, category: 'fan', name: 'å†œå®¶å°ç‚’è‚‰ç›–é¥­', price: 15.99, spicy: true },
      { id: 4, category: 'fan', name: 'é…¸è±†è§’é¸¡æ‚ç›–é¥­', price: 16.99, spicy: true },
      { id: 5, category: 'fan', name: 'é…¸è±†è§’è‚‰æ²«ç›–é¥­', price: 16.99, spicy: true },
      { id: 6, category: 'fan', name: 'ä¹Œç¬‹å°ç‚’è‚‰ç›–é¥­', price: 16.99, spicy: true },
      { id: 7, category: 'fan', name: 'é±¼é¦™èŒ„å­ç›–é¥­', price: 14.99, spicy: true },
      { id: 8, category: 'fan', name: 'å°–æ¤’è‚¥è‚ ç›–é¥­', price: 15.99, spicy: true },
      { id: 9, category: 'fan', name: 'ç³–é†‹é±¼æŸ³ç›–é¥­', price: 15.99, spicy: true },
      { id: 10, category: 'fan', name: 'é‡‘æ±¤é…¸èœæ¯”è±†è…å«©çš„é±¼+ç±³é¥­', price: 17.99, spicy: true },
      { id: 11, category: 'fan', name: 'é‡‘æ±¤é…¸èœè‚¥ç‰›+ç±³é¥­', price: 17.99, spicy: true },

      // ç‚’é¥­ç±»
      { id: 12, category: 'friedrice', name: 'è’œè–¹è…Šè‚‰ç‚’é¥­', price: 13.00, spicy: true },
      { id: 13, category: 'friedrice', name: 'é‚£ä¸€å¹´è›‹ç‚’é¥­', price: 13.00, spicy: true },
      { id: 14, category: 'friedrice', name: 'è èé¸¡ç²’ç‚’é¥­', price: 13.00, spicy: true },

      // å°é£Ÿ
      { id: 15, category: 'snack', name: 'å‡‰æ‹ŒåœŸè±†ä¸ï¼ˆå°ä»½ï¼‰+ ä»»æ„ POP', price: 2.69, spicy: true },

      // é¥®æ–™
      { id: 16, category: 'drinks', name: 'å¯ä¹', price: 1.99, spicy: false },
      { id: 17, category: 'drinks', name: 'æ— ç³–å¯ä¹', price: 1.99, spicy: false },
      { id: 18, category: 'drinks', name: 'é›ªç¢§', price: 1.99, spicy: false },
      { id: 19, category: 'drinks', name: 'Canada Dry', price: 1.99, spicy: false },
      { id: 20, category: 'drinks', name: 'åº·å¸ˆå‚…å†°çº¢èŒ¶', price: 3.50, spicy: false }
    ];

    // TODOï¼šæ”¹æˆä½ çš„çœŸå® EMT é‚®ç®±
    const EMT_EMAIL = "corinna29@live.ca";

    const menuListMainEl = document.getElementById('menuListMain');
    const menuListRiceEl = document.getElementById('menuListRice');
    const menuListSnackEl = document.getElementById('menuListSnack');
    const menuListDrinksEl = document.getElementById('menuListDrinks');

    function renderMenuForCategory(category, containerEl) {
      containerEl.innerHTML = '';
      menuItems.filter(item => item.category === category).forEach(item => {
        const div = document.createElement('div');
        div.className = 'menu-item';

        const spicyHtml = item.spicy ? `
          <div class="spicy-row">
            <span>è¾£åº¦ï¼š</span>
            <select data-spicy-id="${item.id}">
              <option value="ä¸è¾£">ä¸è¾£</option>
              <option value="æ­£å¸¸è¾£" selected>æ­£å¸¸è¾£</option>
              <option value="åŠ è¾£">åŠ è¾£</option>
            </select>
          </div>
        ` : '';

        div.innerHTML = `
          <div>
            <div class="menu-header">
              <div class="menu-name">${item.name}</div>
              <div class="menu-price">CAD $${item.price.toFixed(2)}</div>
            </div>
          </div>
          <div class="qty-row">
            <span>æ•°é‡ï¼ˆä»½ï¼‰ï¼š</span>
            <input type="number" min="0" max="20" value="0" data-id="${item.id}">
          </div>
          ${spicyHtml}
        `;
        containerEl.appendChild(div);
      });
    }

    function renderAllMenus() {
      renderMenuForCategory('fan', menuListMainEl);
      renderMenuForCategory('friedrice', menuListRiceEl);
      renderMenuForCategory('snack', menuListSnackEl);
      renderMenuForCategory('drinks', menuListDrinksEl);
    }

    renderAllMenus();

    // é»˜è®¤æ—¥æœŸè®¾ä¸ºæ˜å¤©ï¼ˆæš‚æ—¶å…ˆä¿ç•™è¿™ä¸ªé€»è¾‘ï¼‰
    (function setDefaultDate() {
      const dateInput = document.getElementById('orderDate');
      const d = new Date();
      d.setDate(d.getDate() + 1);
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth() + 1).padStart(2, '0');
      const dd = String(d.getDate()).padStart(2, '0');
      dateInput.value = `${yyyy}-${mm}-${dd}`;
    })();

    // ================================
    // æäº¤è®¢å•é€»è¾‘
    // ================================
    const submitBtn = document.getElementById('submitBtn');
    const errorMsg = document.getElementById('errorMsg');
    const resultBox = document.getElementById('result');
    const orderNoEl = document.getElementById('orderNo');
    const orderNoForEmtEl = document.getElementById('orderNoForEmt');
    const totalAmountEl = document.getElementById('totalAmount');
    const itemsSummaryEl = document.getElementById('itemsSummary');
    const orderDateShowEl = document.getElementById('orderDateShow');
    const pickupTimeShowWrapper = document.getElementById('pickupTimeShowWrapper');
    const pickupTimeShowEl = document.getElementById('pickupTimeShow');
    const emtEmailEl = document.getElementById('emtEmail');

    emtEmailEl.textContent = EMT_EMAIL;

    submitBtn.addEventListener('click', function () {
      errorMsg.style.display = 'none';
      resultBox.style.display = 'none';

      const orderDate = document.getElementById('orderDate').value;
      const pickupTime = document.getElementById('pickupTime').value;
      const nickName = document.getElementById('customerName').value.trim();
      const phone = document.getElementById('customerPhone').value.trim();
      const wechatId = document.getElementById('wechatId').value.trim();

      if (!orderDate) {
        return showError('è¯·é€‰æ‹©å–é¤æ—¥æœŸ');
      }

      const todayStr = new Date().toISOString().slice(0,10);
      if (orderDate < todayStr) {
        return showError('å–é¤æ—¥æœŸä¸èƒ½æ—©äºä»Šå¤©');
      }

      if (!nickName) {
        return showError('è¯·å¡«å†™æ˜µç§°');
      }

      if (!wechatId) {
        return showError('è¯·å¡«å†™å¾®ä¿¡å·ï¼Œæ–¹ä¾¿ä¸å®¢æœæ²Ÿé€š');
      }

      // è¯»å–æ‰€æœ‰æ•°é‡
      const qtyInputs = document.querySelectorAll('input[type="number"][data-id]');
      let hasItem = false;
      let total = 0;
      const orderedItems = [];

      qtyInputs.forEach(input => {
        const qty = parseInt(input.value || '0', 10);
        if (qty > 0) {
          const id = parseInt(input.getAttribute('data-id'), 10);
          const item = menuItems.find(m => m.id === id);
          if (item) {
            hasItem = true;
            const itemTotal = item.price * qty;

            let spicyLevel = '';
            if (item.spicy) {
              const spicySelect = document.querySelector(`select[data-spicy-id="${item.id}"]`);
              spicyLevel = spicySelect ? spicySelect.value : '';
            }

            total += itemTotal;
            orderedItems.push({
              ...item,
              quantity: qty,
              itemTotal,
              spicyLevel
            });
          }
        }
      });

      if (!hasItem) {
        return showError('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªèœå“æˆ–é¥®æ–™çš„æ•°é‡');
      }

      // ç”Ÿæˆè®¢å•å·ï¼ˆæœ¬åœ°ï¼šæ—¥æœŸ + å½“æ—¥åºå·ï¼‰
      const dateStr = orderDate.replace(/-/g, '');
      const key = 'orderCount_' + dateStr;
      const prevCount = parseInt(localStorage.getItem(key) || '0', 10);
      const seq = prevCount + 1;
      localStorage.setItem(key, seq.toString());
      const seqStr = String(seq).padStart(2, '0');
      const orderNo = `${dateStr}-${seqStr}`;

      // å±•ç¤ºç»“æœ
      orderNoEl.textContent = orderNo;
      orderNoForEmtEl.textContent = orderNo;
      totalAmountEl.textContent = 'CAD $' + total.toFixed(2);
      orderDateShowEl.textContent = orderDate;
      if (pickupTime) {
        pickupTimeShowWrapper.style.display = 'inline';
        pickupTimeShowEl.textContent = pickupTime;
      } else {
        pickupTimeShowWrapper.style.display = 'none';
      }

      itemsSummaryEl.innerHTML = '';
      orderedItems.forEach(item => {
        const li = document.createElement('li');
        const spicyText = item.spicy ? `ï¼ˆ${item.spicyLevel}ï¼‰` : '';
        li.textContent = `${item.name}${spicyText} Ã— ${item.quantity} = CAD $${item.itemTotal.toFixed(2)}`;
        itemsSummaryEl.appendChild(li);
      });

      resultBox.style.display = 'block';

      // æœªæ¥å¦‚æœè¦å†™å…¥ Google Sheet / åç«¯ï¼Œå¯ä»¥åœ¨è¿™é‡Œç»„è£… payload å‘é€
      // const payload = { orderNo, orderDate, pickupTime, nickName, phone, wechatId, total, items: orderedItems };
    });

    function showError(msg) {
      errorMsg.textContent = msg;
      errorMsg.style.display = 'block';
    }
  </script>
</body>
</html>
