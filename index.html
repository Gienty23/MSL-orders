<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>é¾™é—¨é˜µ MSL é¢„è®¢å•</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --primary: #f97316;
      --primary-dark: #ea580c;
      --accent-red: #ef4444;
      --bg: #0f172a;
      --card-bg: #020617;
      --text-main: #f9fafb;
      --text-sub: #9ca3af;
      --border-sub: #1f2937;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      margin: 0;
      padding: 16px;
      background: radial-gradient(circle at top, #1f2933 0, #020617 60%);
      color: var(--text-main);
    }

    .page-wrap {
      max-width: 980px;
      margin: 0 auto;
    }

    .container {
      background: linear-gradient(135deg, rgba(15,23,42,0.96), rgba(15,23,42,0.98));
      border-radius: 24px;
      padding: 18px 18px 26px;
      box-shadow: 0 25px 60px rgba(0,0,0,0.55);
      border: 1px solid rgba(148,163,184,0.2);
    }

    .header {
      display: flex;
      gap: 14px;
      margin-bottom: 18px;
      align-items: center;
    }

    .logo-wrap {
      width: 64px;
      height: 64px;
      border-radius: 20px;
      overflow: hidden;
      flex-shrink: 0;
      box-shadow: 0 10px 30px rgba(248,113,113,0.5);
    }

    .logo-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    h1 {
      margin: 0 0 4px;
      font-size: 24px;
      letter-spacing: 0.03em;
    }

    .sub-title {
      font-size: 13px;
      color: var(--text-sub);
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }

    .chip {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      color: #e5e7eb;
      background: rgba(15,23,42,0.8);
    }

    h2 {
      font-size: 17px;
      margin: 0 0 8px;
    }

    .section {
      margin-bottom: 22px;
      padding-bottom: 18px;
      border-bottom: 1px dashed rgba(55,65,81,0.7);
    }

    .section:last-child {
      border-bottom: none;
      padding-bottom: 0;
      margin-bottom: 0;
    }

    .step-tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: var(--text-sub);
      margin-bottom: 3px;
    }

    .step-circle {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      background: rgba(248,113,113,0.18);
      border: 1px solid rgba(248,113,113,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: #fecaca;
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      font-size: 13px;
    }

    input[type="date"],
    input[type="time"],
    input[type="text"],
    input[type="tel"],
    textarea,
    select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid rgba(75,85,99,0.9);
      box-sizing: border-box;
      font-size: 14px;
      background: rgba(15,23,42,0.9);
      color: var(--text-main);
    }

    input::placeholder,
    textarea::placeholder {
      color: rgba(148,163,184,0.8);
    }

    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 1px rgba(249,115,22,0.4);
    }

    textarea {
      resize: vertical;
      min-height: 60px;
    }

    .two-col {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
    }

    .hint {
      font-size: 12px;
      color: var(--text-sub);
      margin-top: 4px;
    }

    .menu-group-title {
      font-size: 13px;
      font-weight: 600;
      margin: 10px 0 6px;
      color: #e5e7eb;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .menu-group-tag {
      font-size: 10px;
      padding: 1px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      color: #f97316;
    }

    .menu-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      grid-gap: 12px;
    }

    .menu-item {
      border-radius: 16px;
      padding: 8px 8px 10px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background: radial-gradient(circle at top left, rgba(248,250,252,0.02), rgba(15,23,42,0.96));
      border: 1px solid rgba(55,65,81,0.8);
      box-shadow: 0 6px 15px rgba(0,0,0,0.45);
    }

    .menu-img {
      width: 100%;
      aspect-ratio: 1 / 1;
      border-radius: 14px;
      overflow: hidden;
      margin-bottom: 8px;
      background: linear-gradient(135deg, rgba(15,23,42,0.1), rgba(15,23,42,0.7));
      position: relative;
    }

    .menu-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .menu-img-placeholder {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: rgba(255,255,255,0.8);
      background: linear-gradient(135deg, rgba(15,23,42,0.1), rgba(15,23,42,0.7));
      backdrop-filter: blur(2px);
    }

    .menu-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 4px;
      gap: 8px;
    }

    .menu-name {
      font-weight: 600;
      font-size: 14px;
      line-height: 1.3;
    }

    .menu-price {
      color: #fecaca;
      font-weight: 700;
      font-size: 14px;
      white-space: nowrap;
    }

    .menu-tags {
      font-size: 11px;
      color: var(--text-sub);
      margin-bottom: 4px;
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .tag-spicy {
      color: #f97316;
    }

    .menu-desc {
      font-size: 11px;
      color: var(--text-sub);
      margin-bottom: 6px;
    }

    .menu-footer {
      display: flex;
      justify-content: flex-end;
      margin-top: 4px;
    }

    .btn,
    .btn-secondary,
    .btn-primary,
    .btn-add,
    .cart-remove {
      font-family: inherit;
    }

    .btn {
      display: inline-block;
      padding: 12px 22px;
      border: none;
      border-radius: 999px;
      font-size: 15px;
      cursor: pointer;
      background: linear-gradient(135deg, var(--primary), var(--accent-red));
      color: #fff;
      font-weight: 600;
      text-align: center;
      box-shadow: 0 10px 24px rgba(248,113,113,0.6);
      letter-spacing: 0.03em;
    }

    .btn:active {
      transform: translateY(1px);
      box-shadow: 0 6px 16px rgba(248,113,113,0.55);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: none;
    }

    .btn-add {
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid rgba(248,113,113,0.7);
      background: rgba(248,113,113,0.1);
      color: #fecaca;
      font-size: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .btn-add:hover {
      background: rgba(248,113,113,0.25);
    }

    .error {
      color: #fecaca;
      font-size: 13px;
      margin-top: 8px;
    }

    .result-box {
      background: radial-gradient(circle at top left, rgba(34,197,94,0.2), rgba(15,23,42,0.98));
      border-radius: 16px;
      padding: 14px 14px 10px;
      border: 1px solid rgba(34,197,94,0.5);
      margin-top: 14px;
      font-size: 14px;
    }

    .result-row {
      margin-bottom: 6px;
    }

    .highlight {
      font-weight: 700;
      color: #fef9c3;
    }

    .small {
      font-size: 13px;
      color: #e5e7eb;
    }

    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: rgba(250,204,21,0.1);
      color: #facc15;
      border: 1px solid rgba(250,204,21,0.6);
      margin-left: 6px;
    }

    .items-summary {
      font-size: 14px;
      margin-top: 8px;
    }

    .items-summary ul {
      margin: 4px 0 0;
      padding-left: 20px;
    }

    .cart-empty {
      font-size: 13px;
      color: var(--text-sub);
      padding: 4px 0;
    }

    .cart-items {
      margin-top: 6px;
      border-radius: 14px;
      border: 1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.9);
      padding: 8px 10px;
      max-height: 260px;
      overflow-y: auto;
    }

    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 0;
      border-bottom: 1px dashed rgba(55,65,81,0.8);
      gap: 10px;
    }

    .cart-item:last-child {
      border-bottom: none;
    }

    .cart-item-name {
      font-size: 13px;
      font-weight: 600;
    }

    .cart-item-meta {
      font-size: 12px;
      color: var(--text-sub);
    }

    .cart-remove {
      border-radius: 999px;
      border: 1px solid rgba(239,68,68,0.7);
      background: rgba(127,29,29,0.6);
      color: #fee2e2;
      font-size: 11px;
      padding: 3px 8px;
      cursor: pointer;
      white-space: nowrap;
    }

    .cart-remove:hover {
      background: rgba(127,29,29,0.9);
    }

    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.75);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 40;
    }

    .modal {
      width: 100%;
      max-width: 340px;
      background: #020617;
      border-radius: 18px;
      padding: 14px 16px 12px;
      border: 1px solid rgba(148,163,184,0.7);
      box-shadow: 0 20px 50px rgba(0,0,0,0.6);
    }

    .modal-title {
      font-size: 16px;
      margin-bottom: 8px;
    }

    .modal-row {
      font-size: 13px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .modal-row input[type="number"],
    .modal-row select {
      max-width: 160px;
      padding: 5px 8px;
      border-radius: 8px;
      border: 1px solid rgba(75,85,99,0.9);
      background: rgba(15,23,42,0.9);
      color: var(--text-main);
      font-size: 13px;
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 6px;
    }

    .btn-secondary {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      background: rgba(15,23,42,0.9);
      color: #e5e7eb;
      padding: 6px 14px;
      font-size: 13px;
      cursor: pointer;
    }

    .btn-primary {
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, var(--primary), var(--accent-red));
      color: #fff;
      padding: 6px 16px;
      font-size: 13px;
      cursor: pointer;
    }

    @media (max-width: 640px) {
      .container {
        padding: 16px 12px 22px;
      }
      h1 {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
<div class="page-wrap">
  <div class="container">
    <div class="header">
      <div class="logo-wrap">
        <!-- ä½ å¯ä»¥æŠŠ images/logo.png æ¢æˆè‡ªå·±çš„ logo -->
        <img src="./images/logo.png" alt="MSL Logo" class="logo-img">
      </div>
      <div>
        <h1>MSLé¾™é—¨é˜µ é¢„è®¢å•</h1>
        <div class="sub-title">æå‰é¢„è®¢ Â· ç°åœºå–é¤ Â· EMT æ”¯ä»˜</div>
        <div class="chips">
          <span class="chip">ä¸‰æ ¼ä¾¿å½“ Â· é‡‘æ±¤æ±¤é”…</span>
          <span class="chip">ç‚’é¥­å¥—é¤ Â· å°é£Ÿ / æ±¤ç±»</span>
          <span class="chip">ä»¥æ”¶åˆ° EMT + å®¢æœç¡®è®¤ä¸ºå‡†</span>
        </div>
      </div>
    </div>

    <!-- 1. å–é¤ä¿¡æ¯ -->
    <div class="section">
      <div class="step-tag">
        <div class="step-circle">1</div> å¡«å†™å–é¤ä¿¡æ¯
      </div>
      <h2>å–é¤ä¿¡æ¯</h2>
      <div class="two-col">
        <div>
          <label for="orderDate">è®¢é¤æ—¥æœŸï¼ˆå¿…å¡«ï¼‰</label>
          <input type="date" id="orderDate"
                 min="2025-12-05"
                 max="2026-03-15">
          <div class="hint">å½“å‰åªå¼€æ”¾ 2025-12-05 è‡³ 2026-03-15 æœŸé—´çš„å‘¨å…­å–é¤ï¼ˆåç»­å¯èƒ½å¼€æ”¾å‘¨æ—¥ï¼‰ã€‚</div>
        </div>
      </div>
      <div class="two-col" style="margin-top: 12px;">
        <div>
          <label for="customerName">æ˜µç§°ï¼ˆå¿…å¡«ï¼‰</label>
          <input type="text" id="customerName" placeholder="ä¾‹å¦‚ï¼šå°ç‹ / å°çº¢">
        </div>
        <div>
          <label for="customerPhone">è”ç³»ç”µè¯ï¼ˆå¯é€‰ï¼Œæ–¹ä¾¿ç°åœºè”ç³»ï¼‰</label>
          <input type="tel" id="customerPhone" placeholder="ä¾‹å¦‚ï¼š647-000-0000">
        </div>
      </div>
      <div style="margin-top: 12px;">
        <label for="wechatId">å¾®ä¿¡å·ï¼ˆå¿…å¡«ï¼Œæ–¹ä¾¿ä¸å®¢æœæ²Ÿé€šï¼‰</label>
        <input type="text" id="wechatId" placeholder="è¯·è¾“å…¥å¸¸ç”¨å¾®ä¿¡å·">
      </div>
    </div>

    <!-- 2. èœå•é€‰æ‹© -->
    <div class="section">
      <div class="step-tag">
        <div class="step-circle">2</div> é€‰æ‹©èœå“ï¼ˆç‚¹å‡»ã€Œï¼‹ã€æ·»åŠ åˆ°è´­ç‰©è½¦ï¼‰
      </div>
      <h2>èœå“é€‰æ‹©</h2>
      <div class="hint">
        ä¸‰æ ¼ä¾¿å½“ / é‡‘æ±¤ç³»åˆ— / ç‚’é¥­å¥—é¤ / å°é£Ÿå¯é€‰æ‹©è¾£åº¦ï¼›æ±¤ç±»é»˜è®¤æ— è¾£åº¦ã€‚æ¯ç‚¹å‡»ä¸€æ¬¡ã€Œï¼‹ã€å³ä¸ºä¸€ç»„é…ç½®ï¼Œå¯é‡å¤æ·»åŠ ä¸åŒè¾£åº¦ç»„åˆã€‚
      </div>

      <div class="menu-group-title">
        ğŸ± ä¸‰æ ¼ä¾¿å½“ç±»ï¼ˆä¸»èœ + ç•ªèŒ„ç‚’è›‹ + ç±³é¥­ï¼‰
        <span class="menu-group-tag">Combination Plates</span>
      </div>
      <div class="menu-list" id="menuListBento"></div>

      <div class="menu-group-title">
        ğŸ² é‡‘æ±¤ç³»åˆ—ï¼ˆæ±¤é”… + ç±³é¥­ï¼‰
        <span class="menu-group-tag">Golden Soup EntrÃ©es</span>
      </div>
      <div class="menu-list" id="menuListGolden"></div>

      <div class="menu-group-title">
        ğŸ› ç‚’é¥­å¥—é¤ï¼ˆç‚’é¥­ + æ±¤ï¼‰
        <span class="menu-group-tag">Fried Rice Combos</span>
      </div>
      <div class="menu-list" id="menuListFried"></div>

      <div class="menu-group-title">
        ğŸ¥— å°é£Ÿ / åŠ è´­
        <span class="menu-group-tag">Side Dish / Add-ons</span>
      </div>
      <div class="menu-list" id="menuListSide"></div>

      <div class="menu-group-title">
        ğŸ² æ±¤ç±»ï¼ˆå•ç‚¹ï¼‰
        <span class="menu-group-tag">Soup (A La Carte)</span>
      </div>
      <div class="menu-list" id="menuListSoup"></div>
    </div>

    <!-- 3. è´­ç‰©è½¦ -->
    <div class="section">
      <div class="step-tag">
        <div class="step-circle">3</div> æŸ¥çœ‹ / ç¼–è¾‘è´­ç‰©è½¦
      </div>
      <h2>å·²é€‰èœå“</h2>
      <div class="hint">å¯éšæ—¶ç§»é™¤æˆ–ä¿®æ”¹ï¼Œå¦‚éœ€ä¸åŒè¾£åº¦è¯·åˆ†å¤šæ¬¡æ·»åŠ åŒä¸€èœå“ã€‚</div>
      <div id="cartEmpty" class="cart-empty">
        å½“å‰è´­ç‰©è½¦ä¸ºç©ºï¼Œè¯·åœ¨ä¸Šæ–¹èœå“å¡ç‰‡ä¸­ç‚¹å‡»ã€Œï¼‹ã€æ·»åŠ ã€‚
      </div>
      <div id="cartItems" class="cart-items" style="display:none;"></div>
      <div id="cartTotal" style="margin-top:8px; font-size:14px; display:none;">
        å°è®¡ï¼š<span class="highlight" id="cartTotalAmount"></span>
      </div>
    </div>

    <!-- 4. å¤‡æ³¨ + æäº¤ -->
    <div class="section">
      <div class="step-tag">
        <div class="step-circle">4</div> å¡«å†™å¤‡æ³¨å¹¶æäº¤
      </div>
      <h2>å¤‡æ³¨ç‰¹æ®Šè¦æ±‚</h2>
      <label for="remark">å¤‡æ³¨</label>
      <textarea id="remark" placeholder="ä¾‹å¦‚ï¼šç±³é¥­å°‘ä¸€ç‚¹ / ä¸è¦èŠ±ç”Ÿ / ä¸è¦èŠ±æ¤’ / å„ä»½å†™ä¸Šæ˜µç§°ç­‰"></textarea>

      <div style="margin-top:14px;">
        <button class="btn" id="submitBtn">æäº¤è®¢å•</button>
        <div class="error" id="errorMsg" style="display:none;"></div>

        <div id="result" style="display:none;" class="result-box">
          <div class="result-row">
            âœ… å°å®¢æœå¾®ä¿¡å· hotopiasc é¢„è®¢å•å·²æäº¤ï¼<span class="badge">å½“å¤©å†…å®Œæˆ EMT</span>
          </div>
          <div class="result-row">
            è®¢å•å·ï¼š<span class="highlight" id="orderNo"></span>
          </div>
          <div class="result-row">
            å–é¤æ—¥æœŸï¼š<span class="highlight" id="orderDateShow"></span>
          </div>
          <div class="result-row">
            è®¢å•æ€»é‡‘é¢ï¼š<span class="highlight" id="totalAmount"></span>
          </div>
          <div class="result-row">
            è¯· EMT è‡³ï¼š<span class="highlight" id="emtEmail">test@gmail.com</span>
          </div>
          <div class="result-row small">
            ğŸ‘‰ EMT å¤‡æ³¨è¯·å¡«å†™è®¢å•å·ï¼š<span class="highlight" id="orderNoForEmt"></span>
          </div>
          <div class="result-row small">
            âš ï¸ è®¢å•ä»…åœ¨æœ¬åº—æ”¶åˆ° EMT ä»˜æ¬¾å¹¶é€šè¿‡å¾®ä¿¡ / ç”µè¯ä¸æ‚¨ç¡®è®¤åæ‰è§†ä¸ºæœ‰æ•ˆã€‚å½“å¤©å†…æœªä»˜æ¬¾ï¼Œé¢„è®¢å•å°†è‡ªåŠ¨ä½œåºŸã€‚
          </div>
          <div class="items-summary">
            <div>æœ¬å•èœå“ï¼š</div>
            <ul id="itemsSummary"></ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- åŠ èœå¼¹çª— -->
<div id="modalOverlay" class="modal-overlay">
  <div class="modal">
    <div class="modal-title" id="modalDishName">æ·»åŠ èœå“</div>
    <div class="modal-row" id="modalSpicyRow">
      <span>è¾£åº¦ï¼š</span>
      <select id="modalSpicySelect">
        <option value="ä¸è¾£">ä¸è¾£</option>
        <option value="æ­£å¸¸è¾£" selected>æ­£å¸¸è¾£</option>
        <option value="åŠ è¾£">åŠ è¾£</option>
      </select>
    </div>
    <div class="modal-row">
      <span>æ•°é‡ï¼š</span>
      <input type="number" id="modalQty" min="1" value="1">
    </div>
    <div class="modal-actions">
      <button id="modalCancel" class="btn-secondary">å–æ¶ˆ</button>
      <button id="modalConfirm" class="btn-primary">åŠ å…¥è´­ç‰©è½¦</button>
    </div>
  </div>
</div>

<script>
  // =======================
  // è®¢é¤æ—¥æœŸä¸å–é¤æ—¶é—´é…ç½®
  // =======================

  // å…è®¸è®¢é¤çš„æ—¥æœŸåŒºé—´ï¼ˆå«é¦–å°¾ï¼‰ï¼Œæ ¼å¼å¿…é¡»æ˜¯ 'YYYY-MM-DD'
  const ORDER_START_DATE = '2025-12-05';
  const ORDER_END_DATE   = '2026-03-15';

  // å…è®¸çš„å–é¤æ˜ŸæœŸå‡ ï¼š0=å‘¨æ—¥,1=å‘¨ä¸€,...,6=å‘¨å…­
  // ç›®å‰ä»…å¼€æ”¾å‘¨å…­ï¼Œå°†æ¥è¦åŠ å‘¨æ—¥ï¼Œæ”¹æˆ [6, 0] å³å¯
  const ALLOWED_WEEKDAYS = [6];

  // ç»™åç«¯ç”¨çš„ pickupTime å­—æ®µï¼ˆå‰ç«¯ä¸å±•ç¤ºï¼‰
  // å¦‚æœä»¥åæƒ³å›ºå®šæ—¶é—´ï¼Œä¾‹å¦‚ 18:00ï¼Œå¯ä»¥æ”¹æˆï¼š'18:00'
  const PICKUP_TIME_DEFAULT = '';

  // =========================
  // èœå•æ•°æ®ï¼ˆä½ å¯ä»¥è°ƒæ•´ï¼‰
  // =========================
  const menuItems = [
    // ğŸ± ä¸‰æ ¼ä¾¿å½“ç±»
    {
      id: 1,
      category: 'bento',
      name: 'å†œå®¶å°ç‚’è‚‰ + è¥¿çº¢æŸ¿é¸¡è›‹',
      price: 16.99,
      spicy: true,
      kcal: 833,
      desc: 'Pork, Green & Red Chili Peppers, Tomatoes & Eggs, Rice, etc.',
      imageUrl: './images/å†œå®¶å°ç‚’è‚‰.png'
    },
    {
      id: 2,
      category: 'bento',
      name: 'å®«ä¿é¸¡ä¸ + è¥¿çº¢æŸ¿é¸¡è›‹',
      price: 16.99,
      spicy: true,
      kcal: 815,
      desc: 'Chicken, Peanuts, Red Chili Peppers, Tomatoes & Eggs, Rice, etc.',
      imageUrl: './images/å®«ä¿é¸¡ä¸.png'
    },
    {
      id: 3,
      category: 'bento',
      name: 'é±¼é¦™èŒ„å­ + è¥¿çº¢æŸ¿é¸¡è›‹',
      price: 15.99,
      spicy: true,
      kcal: 720,
      desc: 'Eggplant, Wood Ear Mushroom, Red Chili Peppers, Tomatoes & Eggs, Rice, etc.',
      imageUrl: './images/é±¼é¦™èŒ„å­.png'
    },
    {
      id: 4,
      category: 'bento',
      name: 'å·æ¤’é¸¡ç¿… + è¥¿çº¢æŸ¿é¸¡è›‹',
      price: 18.99,
      spicy: true,
      kcal: 850,
      desc: 'Chicken Wings, Green & Red Chili Peppers, Tomatoes & Eggs, Rice, etc.',
      imageUrl: './images/å·æ¤’é¸¡ç¿….png'
    },
    {
      id: 5,
      category: 'bento',
      name: 'å°–æ¤’è‚¥è‚  + è¥¿çº¢æŸ¿é¸¡è›‹',
      price: 16.99,
      spicy: true,
      kcal: 820,
      desc: 'Pork Intestine, Green & Red Chili Peppers, Tomatoes & Eggs, Rice, etc.',
      imageUrl: './images/å°–æ¤’è‚¥è‚ .png'
    },
    {
      id: 6,
      category: 'bento',
      name: 'é…¸è±†è§’ç‚’è‚‰æ²« + è¥¿çº¢æŸ¿é¸¡è›‹',
      price: 17.99,
      spicy: true,
      kcal: 738,
      desc: 'Minced Pork, Pickled Green Beans, Tomatoes & Eggs, Rice, etc.',
      imageUrl: './images/é…¸è±†è§’è‚‰æ²«.png'
    },
    {
      id: 7,
      category: 'bento',
      name: 'ç…§çƒ§è‚¥ç‰› + è¥¿çº¢æŸ¿é¸¡è›‹',
      price: 17.99,
      spicy: false,
      kcal: 845,
      desc: 'Teriyaki Beef + Tomatoes & Eggs, Rice, etc.',
      imageUrl: './images/é‡‘æ±¤é…¸èœè‚¥ç‰›.png'
    },
    {
      id: 8,
      category: 'bento',
      name: 'è‚‰é£Ÿä¸»ä¹‰ + ç±³é¥­',
      price: 18.99,
      spicy: true,
      kcal: 910,
      desc: 'Meat Balls, Pork Intestine, Spam, Beef Tripe, Rice, etc.',
      imageUrl: './images/è‚‰é£Ÿä¸»ä¹‰.png'
    },
    {
      id: 9,
      category: 'bento',
      name: 'é¦™è¾£å››å–œ + ç±³é¥­',
      price: 18.99,
      spicy: true,
      kcal: 810,
      desc: 'Shrimp, Pork Rib, Beef Sirloin, Lamb Cube, Rice, etc.',
      imageUrl: './images/é¦™è¾£å››å–œ.png'
    },
    {
      id: 10,
      category: 'bento',
      name: 'ç³–é†‹é±¼æŸ³ + è¥¿çº¢æŸ¿é¸¡è›‹',
      price: 16.99,
      spicy: false,
      kcal: 750,
      desc: 'Fried Fish Fillet, Sweet & Sour Sauce, Tomatoes & Eggs, Rice, etc.',
      imageUrl: './images/ç³–é†‹é±¼æŸ³.png'
    },
    {
      id: 11,
      category: 'bento',
      name: 'éº»å©†è±†è… + è¥¿çº¢æŸ¿é¸¡è›‹',
      price: 15.99,
      spicy: true,
      kcal: 719,
      desc: 'Minced Pork, Tofu, Red Chili Peppers, Tomatoes & Eggs, Rice, etc.',
      imageUrl: './images/éº»å©†è±†è….png'
    },

    // ğŸ² é‡‘æ±¤ç³»åˆ—
    {
      id: 12,
      category: 'golden',
      name: 'é‡‘æ±¤é…¸èœé±¼ + ç±³é¥­',
      price: 18.49,
      spicy: true,
      kcal: 860,
      desc: 'Fish Fillet, Enoki Mushroom, Glass Noodles, Golden Pickled Cabbage Soup, Rice, etc.',
      imageUrl: './images/é‡‘æ±¤é…¸èœé±¼.png'
    },
    {
      id: 13,
      category: 'golden',
      name: 'é‡‘æ±¤é…¸èœè‚¥ç‰› + ç±³é¥­',
      price: 18.49,
      spicy: true,
      kcal: 870,
      desc: 'Beef Slices, Enoki Mushroom, Glass Noodles, Golden Pickled Cabbage Soup, Rice, etc.',
      imageUrl: './images/é‡‘æ±¤é…¸èœè‚¥ç‰›.png'
    },

    // ğŸ› ç‚’é¥­å¥—é¤
    {
      id: 14,
      category: 'fried',
      name: 'å’–å–±ç‰›è‚‰ç‚’é¥­ + å†¬ç“œè™¾ä»æ±¤',
      price: 16.0,
      spicy: false,
      kcal: 854,
      desc: 'Curry Beef Fried Rice + Winter Melon Shrimp Soup',
      imageUrl: './images/å’–å–±ç‰›è‚‰.png'
    },
    {
      id: 15,
      category: 'fried',
      name: 'é‚£ä¸€å¹´è›‹ç‚’é¥­ + å†¬ç“œè™¾ä»æ±¤',
      price: 16.0,
      spicy: false,
      kcal: 754,
      desc: 'Classic Fried Rice + Winter Melon Shrimp Soup',
      imageUrl: './images/é‚£ä¸€å¹´è›‹ç‚’é¥­.png'
    },

    // ğŸ¥— å°é£Ÿ / åŠ è´­
    {
      id: 16,
      category: 'side',
      name: 'å‡‰æ‹ŒåœŸè±†ä¸ + POP',
      price: 3.0,
      spicy: true,
      kcal: 430,
      desc: 'Shredded Potatoes, Chili Peppers, Green Onions, etc.',
      imageUrl: './images/å¥—é¤.png'
    },

    // ğŸ² æ±¤ç±»
    {
      id: 17,
      category: 'soup',
      name: 'å†¬ç“œè™¾ä»æ±¤ï¼ˆ12ozï¼‰',
      price: 3.99,
      spicy: false,
      kcal: 94,
      desc: 'Winter Melon & Shrimp Soup',
      imageUrl: './images/å†¬ç“œè™¾ä»æ±¤.png'
    }
  ];

  // Apps Script Web App URLï¼ˆæœ€æ–°ï¼‰
  const SHEET_API_URL =
  "https://script.google.com/macros/s/AKfycbz4TIem6vz1t0n7bO1daEOvnGAK_jkfN_Ef0kPFOKC4Ctwz3C8BSSCA8l8eITWno22n/exec";

  // ä½ è‡ªå·±çš„ EMT é‚®ç®±
  const EMT_EMAIL = "test@gmail.com";

  let hasSubmitted = false;
  let cart = [];

  const menuListBentoEl = document.getElementById('menuListBento');
  const menuListGoldenEl = document.getElementById('menuListGolden');
  const menuListFriedEl = document.getElementById('menuListFried');
  const menuListSideEl = document.getElementById('menuListSide');
  const menuListSoupEl = document.getElementById('menuListSoup');

  const cartEmptyEl = document.getElementById('cartEmpty');
  const cartItemsEl = document.getElementById('cartItems');
  const cartTotalBox = document.getElementById('cartTotal');
  const cartTotalAmountEl = document.getElementById('cartTotalAmount');

  const submitBtn = document.getElementById('submitBtn');
  const errorMsg = document.getElementById('errorMsg');
  const resultBox = document.getElementById('result');
  const orderNoEl = document.getElementById('orderNo');
  const orderNoForEmtEl = document.getElementById('orderNoForEmt');
  const totalAmountEl = document.getElementById('totalAmount');
  const itemsSummaryEl = document.getElementById('itemsSummary');
  const orderDateShowEl = document.getElementById('orderDateShow');
  const emtEmailEl = document.getElementById('emtEmail');

  emtEmailEl.textContent = EMT_EMAIL;

  // å¼¹çª—å…ƒç´ 
  const modalOverlay = document.getElementById('modalOverlay');
  const modalDishNameEl = document.getElementById('modalDishName');
  const modalSpicyRow = document.getElementById('modalSpicyRow');
  const modalSpicySelect = document.getElementById('modalSpicySelect');
  const modalQtyInput = document.getElementById('modalQty');
  const modalCancelBtn = document.getElementById('modalCancel');
  const modalConfirmBtn = document.getElementById('modalConfirm');

  let currentDishId = null;

  // æŠŠ 'YYYY-MM-DD' è½¬æˆæœ¬åœ°æ—¶é—´çš„ Dateï¼Œé¿å…æ—¶åŒºæŠŠæ—¥æœŸå¼„é”™
  function createDateFromStr(str) {
    const [y, m, d] = str.split('-').map(n => parseInt(n, 10));
    return new Date(y, m - 1, d);
  }

  function renderMenuForCategory(category, containerEl) {
    containerEl.innerHTML = '';
    menuItems
      .filter(item => item.category === category)
      .forEach(item => {
        const div = document.createElement('div');
        div.className = 'menu-item';

        const imgHtml = `
          <div class="menu-img">
            ${item.imageUrl
              ? `<img src="${item.imageUrl}" alt="${item.name}">`
              : `<div class="menu-img-placeholder">èœå“å›¾ç‰‡å ä½</div>`
            }
          </div>
        `;

        const spicyTagText = item.spicy ? 'å¯é€‰è¾£åº¦' : 'é»˜è®¤æ— è¾£åº¦';

        div.innerHTML = `
          ${imgHtml}
          <div>
            <div class="menu-header">
              <div class="menu-name">${item.name}</div>
              <div class="menu-price">CAD $${item.price.toFixed(2)}</div>
            </div>
            <div class="menu-tags">
              <span class="${item.spicy ? 'tag-spicy' : ''}">${spicyTagText}</span>
              <span>${item.kcal} Kcal</span>
            </div>
            <div class="menu-desc">${item.desc}</div>
            <div class="menu-footer">
              <button class="btn-add" data-id="${item.id}">
                ï¼‹ åŠ å…¥
              </button>
            </div>
          </div>
        `;

        containerEl.appendChild(div);
      });
  }

  function renderAllMenus() {
    renderMenuForCategory('bento', menuListBentoEl);
    renderMenuForCategory('golden', menuListGoldenEl);
    renderMenuForCategory('fried', menuListFriedEl);
    renderMenuForCategory('side', menuListSideEl);
    renderMenuForCategory('soup', menuListSoupEl);
  }

  renderAllMenus();

  // é»˜è®¤æ—¥æœŸè®¾ä¸ºæœ¬å­£å†…æœ€è¿‘ä¸€ä¸ªå…è®¸çš„å–é¤æ—¥
  (function setDefaultDate() {
    const dateInput = document.getElementById('orderDate');

    const start = createDateFromStr(ORDER_START_DATE);
    const end   = createDateFromStr(ORDER_END_DATE);
    const today = new Date();

    // å–ä»Šå¤©å’Œå­£èŠ‚å¼€å§‹æ—¥æœŸä¸­è¾ƒæ™šçš„é‚£ä¸€å¤©
    let d = today > start ? today : start;

    // å¦‚æœå·²ç»è¶…è¿‡å­£èŠ‚ç»“æŸï¼Œå°±å…œåº•ä¸ºå­£èŠ‚å¼€å§‹æ—¥
    if (d > end) {
      d = new Date(start.getTime());
    }

    // å¾€åæ»šåŠ¨åˆ°æœ€è¿‘çš„å…è®¸æ˜ŸæœŸå‡ ï¼ˆç›®å‰åªæœ‰å‘¨å…­ï¼‰
    while (!ALLOWED_WEEKDAYS.includes(d.getDay()) && d <= end) {
      d.setDate(d.getDate() + 1);
    }

    // æ ¼å¼åŒ–ä¸º YYYY-MM-DD
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth() + 1).padStart(2, '0');
    const dd = String(d.getDate()).padStart(2, '0');
    const val = `${yyyy}-${mm}-${dd}`;

    dateInput.value = val;
    dateInput.min = ORDER_START_DATE;
    dateInput.max = ORDER_END_DATE;
  })();

  function openModal(dishId) {
    const dish = menuItems.find(m => m.id === dishId);
    if (!dish) return;
    currentDishId = dishId;
    modalDishNameEl.textContent = dish.name;
    modalQtyInput.value = 1;

    if (dish.spicy) {
      modalSpicyRow.style.display = 'flex';
      modalSpicySelect.value = 'æ­£å¸¸è¾£';
    } else {
      modalSpicyRow.style.display = 'none';
      modalSpicySelect.value = 'æ— è¾£åº¦';
    }

    modalOverlay.style.display = 'flex';
  }

  function closeModal() {
    modalOverlay.style.display = 'none';
    currentDishId = null;
  }

  function renderCart() {
    if (cart.length === 0) {
      cartEmptyEl.style.display = 'block';
      cartItemsEl.style.display = 'none';
      cartTotalBox.style.display = 'none';
      cartItemsEl.innerHTML = '';
      cartTotalAmountEl.textContent = '';
      return;
    }

    cartEmptyEl.style.display = 'none';
    cartItemsEl.style.display = 'block';
    cartTotalBox.style.display = 'block';

    cartItemsEl.innerHTML = '';
    let total = 0;

    cart.forEach((item, index) => {
      const lineTotal = item.price * item.quantity;
      total += lineTotal;
      const div = document.createElement('div');
      div.className = 'cart-item';
      const spicyText = item.spicyLevel ? `ï¼ˆ${item.spicyLevel}ï¼‰` : '';
      div.innerHTML = `
        <div>
          <div class="cart-item-name">${item.name}${spicyText}</div>
          <div class="cart-item-meta">æ•°é‡ï¼šx${item.quantity} ï½œ å°è®¡ï¼šCAD $${lineTotal.toFixed(2)}</div>
        </div>
        <button class="cart-remove" data-index="${index}">åˆ é™¤</button>
      `;
      cartItemsEl.appendChild(div);
    });

    cartTotalAmountEl.textContent = 'CAD $' + total.toFixed(2);
  }

  document.addEventListener('click', function (e) {
    const addBtn = e.target.closest('.btn-add');
    if (addBtn) {
      const id = parseInt(addBtn.getAttribute('data-id'), 10);
      openModal(id);
      return;
    }

    const removeBtn = e.target.closest('.cart-remove');
    if (removeBtn) {
      const idx = parseInt(removeBtn.getAttribute('data-index'), 10);
      if (!isNaN(idx)) {
        cart.splice(idx, 1);
        renderCart();
      }
      return;
    }
  });

  modalCancelBtn.addEventListener('click', function () {
    closeModal();
  });

  modalOverlay.addEventListener('click', function (e) {
    if (e.target === modalOverlay) {
      closeModal();
    }
  });

  modalConfirmBtn.addEventListener('click', function () {
    if (currentDishId == null) return;
    const dish = menuItems.find(m => m.id === currentDishId);
    if (!dish) return;

    const qty = parseInt(modalQtyInput.value || '1', 10);
    if (isNaN(qty) || qty <= 0) {
      alert('æ•°é‡è‡³å°‘ä¸º 1');
      return;
    }

    let spicyLevel = '';
    if (dish.spicy) {
      spicyLevel = modalSpicySelect.value || 'æ­£å¸¸è¾£';
    }

    const existingIndex = cart.findIndex(
      item => item.id === dish.id && item.spicyLevel === spicyLevel
    );
    if (existingIndex >= 0) {
      cart[existingIndex].quantity += qty;
    } else {
      cart.push({
        id: dish.id,
        name: dish.name,
        price: dish.price,
        spicyLevel,
        quantity: qty
      });
    }

    renderCart();
    closeModal();
  });

  function showError(msg) {
    errorMsg.textContent = msg;
    errorMsg.style.display = 'block';
  }

  submitBtn.addEventListener('click', function () {
    errorMsg.style.display = 'none';
    resultBox.style.display = 'none';

    if (hasSubmitted) {
      showError('æœ¬é¡µé¢å·²æˆåŠŸæäº¤ä¸€ä»½é¢„è®¢å•ï¼Œå¦‚éœ€å†æ¬¡ä¸‹å•è¯·åˆ·æ–°é¡µé¢æˆ–é‡æ–°æ‰“å¼€é“¾æ¥ã€‚');
      return;
    }

    const orderDate = document.getElementById('orderDate').value;
    const nickName = document.getElementById('customerName').value.trim();
    const phone = document.getElementById('customerPhone').value.trim();
    const wechatId = document.getElementById('wechatId').value.trim();
    const remark = document.getElementById('remark').value.trim();

    if (!orderDate) {
      return showError('è¯·é€‰æ‹©å–é¤æ—¥æœŸ');
    }

    // 1ï¼‰æ£€æŸ¥æ˜¯å¦åœ¨å…è®¸çš„æ—¥æœŸåŒºé—´å†…
    if (orderDate < ORDER_START_DATE || orderDate > ORDER_END_DATE) {
      return showError(`å½“å‰å¯é€‰æ—¥æœŸä¸º ${ORDER_START_DATE} è‡³ ${ORDER_END_DATE} æœŸé—´çš„å‘¨å…­`);
    }

    // 2ï¼‰æ£€æŸ¥æ˜¯å¦ä¸ºå…è®¸çš„æ˜ŸæœŸå‡ ï¼ˆç›®å‰æ˜¯å‘¨å…­ï¼‰
    const d = createDateFromStr(orderDate);
    const weekday = d.getDay(); // 0=å‘¨æ—¥...6=å‘¨å…­
    if (!ALLOWED_WEEKDAYS.includes(weekday)) {
      return showError('ç›®å‰ä»…å¼€æ”¾å‘¨å…­å–é¤ï¼Œè¯·é€‰æ‹©å‘¨å…­æ—¥æœŸ');
    }

    if (!nickName) {
      return showError('è¯·å¡«å†™æ˜µç§°');
    }

    if (!wechatId) {
      return showError('è¯·å¡«å†™å¾®ä¿¡å·ï¼Œæ–¹ä¾¿ä¸å®¢æœæ²Ÿé€š');
    }

    if (cart.length === 0) {
      return showError('è´­ç‰©è½¦ä¸ºç©ºï¼Œè¯·å…ˆæ·»åŠ è‡³å°‘ä¸€ä»½èœå“');
    }

    // è®¡ç®—æ€»é‡‘é¢
    let totalAmount = 0;
    cart.forEach(item => {
      totalAmount += item.price * item.quantity;
    });

    // ç”Ÿæˆè®¢å•å·ï¼šYYYYMMDD-XX
    const dateStr = orderDate.replace(/-/g, '');
    const key = 'orderCount_' + dateStr;
    const prevCount = parseInt(localStorage.getItem(key) || '0', 10);
    const nextSeq = prevCount + 1;
    const seqStr = String(nextSeq).padStart(2, '0');
    const orderNo = `${dateStr}-${seqStr}`;

    // ç»™åç«¯çš„å–é¤æ—¶é—´ï¼ˆå‰ç«¯ä¸å±•ç¤ºï¼‰
    const pickupTime = PICKUP_TIME_DEFAULT;

    // æœ¬åœ° UI å±•ç¤º
    orderNoEl.textContent = orderNo;
    orderNoForEmtEl.textContent = orderNo;
    totalAmountEl.textContent = 'CAD $' + totalAmount.toFixed(2);
    orderDateShowEl.textContent = orderDate;

    // èœå“åˆ—è¡¨å±•ç¤º
    itemsSummaryEl.innerHTML = '';
    const linesForBackend = [];
    cart.forEach(item => {
      const dishInfo = menuItems.find(m => m.id === item.id);
      const spicyText = dishInfo && dishInfo.spicy && item.spicyLevel
        ? `ï¼ˆ${item.spicyLevel}ï¼‰`
        : '';
      const lineText = `${item.name}${spicyText} Ã— ${item.quantity} = CAD $${(item.price * item.quantity).toFixed(2)}`;

      const li = document.createElement('li');
      li.textContent = lineText;
      itemsSummaryEl.appendChild(li);

      linesForBackend.push(lineText);
    });
    if (remark) {
      const li = document.createElement('li');
      li.textContent = `å¤‡æ³¨ï¼š${remark}`;
      itemsSummaryEl.appendChild(li);
    }

    resultBox.style.display = 'block';

    // é˜²æ­¢é‡å¤æäº¤
    hasSubmitted = true;
    submitBtn.disabled = true;
    submitBtn.textContent = 'å·²æäº¤ï¼ˆæ­£åœ¨å‘é€åˆ°åå°ï¼‰';

    // æŠŠæµæ°´å·å­˜åœ¨ localStorageï¼Œä¸‹æ¬¡åŒä¸€å¤©ä¼šæ¥ç€å¾€åæ’
    localStorage.setItem(key, nextSeq.toString());

    // å‘ç»™ Apps Script çš„æ•°æ®æ ¼å¼
    const payload = {
      orderNo: orderNo,
      orderDate: orderDate,
      pickupTime: pickupTime || '',
      nickName: nickName,
      wechatId: wechatId,
      phone: phone,
      totalAmount: totalAmount.toFixed(2),
      itemsDetail: linesForBackend.join('\n'),
      remark: remark || ''
    };

    // å‘é€åˆ° Google Apps Scriptï¼ˆno-corsï¼Œé¿å… CORS é—®é¢˜ï¼‰
    fetch(SHEET_API_URL, {
      method: 'POST',
      mode: 'no-cors', // å…³é”®ï¼šä¸åš CORS æ ¡éªŒ
      cache: 'no-cache',
      headers: {
        'Content-Type': 'text/plain;charset=utf-8'
      },
      body: JSON.stringify(payload)
    })
      .then(() => {
        console.log('Order sent to backend (no-cors).');
        // UI å·²ç»å±•ç¤ºæˆåŠŸä¿¡æ¯
      })
      .catch(err => {
        console.error('Submission Error:', err);
        showError('è®¢å•å·²åœ¨æœ¬é¡µç”Ÿæˆï¼Œä½†å‘é€åˆ°åå°æ—¶å‡ºé”™ï¼Œè¯·è”ç³»å®¢æœç¡®è®¤æ˜¯å¦æ”¶åˆ°ã€‚é”™è¯¯ï¼š' + err.message);
        submitBtn.disabled = false;
        submitBtn.textContent = 'æäº¤è®¢å•';
        hasSubmitted = false;
      });
  });
</script>
</body>
</html>












